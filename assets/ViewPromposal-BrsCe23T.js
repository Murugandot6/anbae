import{c as p,r as s,j as e,d as A,$ as M,H as E,L as b,B as h,s as R,w as T,a as D}from"./main-CivNnYL8.js";import{R as V}from"./index-D4dw0keJ.js";import{A as q}from"./arrow-left-CxyQXc3_.js";import{C as H}from"./check-CISF5BoX.js";import{C as _}from"./copy-DhwasAQ_.js";import"./index-Chjiymov.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=p("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=p("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=p("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=p("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),O=({lyrics:t,currentTime:n})=>{const[c,i]=s.useState(null),[o,a]=s.useState(""),l=s.useMemo(()=>{if(!t||t.length===0)return-1;let r=t.length-1;for(;r>=0;){if(t[r].time<=n)return r;r--}return-1},[t,n]);return s.useEffect(()=>{const r=l!==-1?t[l].text:null;if(r!==c){a("animate-fade-out");const d=setTimeout(()=>{i(r),a("animate-fade-in")},500);return()=>clearTimeout(d)}},[l,t,c]),t.length?e.jsx("div",{className:"flex items-center justify-center h-full text-center p-4",children:e.jsx("p",{className:A("text-3xl sm:text-4xl md:text-6xl font-bold text-foreground drop-shadow-lg",o),children:c||"â™ª"})}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground text-xl sm:text-2xl",children:e.jsx("p",{children:"Waiting for the song to start..."})})},W=t=>{if(!t)return[];const n=t.split(`
`),c=[],i=/\[(\d{2}):(\d{2})\.(\d{2,3})\]/;for(const o of n){const a=o.match(i);if(a){const l=parseInt(a[1],10),r=parseInt(a[2],10),d=parseInt(a[3].padEnd(3,"0"),10),u=l*60+r+d/1e3,f=o.replace(i,"").trim();f&&c.push({time:u,text:f})}}return c.sort((o,a)=>o.time-a.time)},Y=()=>e.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center text-foreground",children:[e.jsx(T,{}),e.jsx("p",{className:"mt-4 text-base sm:text-xl",children:"Loading Your Special Message..."})]}),y=({message:t})=>e.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center text-foreground text-center p-4",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-destructive mb-3 sm:mb-4",children:"Oops!"}),e.jsx("p",{className:"text-sm sm:text-base",children:t}),e.jsx(b,{to:"/dashboard",children:e.jsx(h,{variant:"outline",className:"mt-4 text-foreground border-border hover:bg-accent hover:text-accent-foreground text-sm sm:text-base px-4 py-2 sm:px-6 sm:py-3",children:"Back to Dashboard"})})]}),ee=()=>{const{id:t}=M(),[n,c]=s.useState(null),[i,o]=s.useState(!0),[a,l]=s.useState(null),[r,d]=s.useState(!1),[u,f]=s.useState(!0),[g,v]=s.useState(0),[k,N]=s.useState(0),[L,j]=s.useState(!1),w=s.useRef(null);s.useEffect(()=>{if(!t){l("No promposal ID provided."),o(!1);return}(async()=>{const{data:x,error:I}=await R.from("proposals").select("id, video_url, lrc_content").eq("id",t).single();I||!x?(l("Could not find this promposal. The link may be incorrect or it may have been deleted."),o(!1)):(c(x),o(!1))})()},[t]);const P=s.useMemo(()=>n?W(n.lrc_content):[],[n]),S=m=>{v(m.playedSeconds)},C=m=>{N(m)},z=()=>{navigator.clipboard.writeText(window.location.href),j(!0),D.success("Link copied to clipboard!"),setTimeout(()=>j(!1),2e3)};return i?e.jsx(Y,{}):a?e.jsx(y,{message:a}):n?e.jsxs(e.Fragment,{children:[e.jsxs(E,{children:[e.jsx("title",{children:"Promposal - Anbae"}),e.jsx("meta",{name:"description",content:"View a special video promposal with synchronized lyrics created on Anbae."})]}),e.jsxs("div",{className:"fixed inset-0 bg-background z-50 flex flex-col items-center justify-center p-4 md:p-8 text-foreground overflow-hidden",children:[e.jsx("div",{style:{display:"none"},children:e.jsx(V,{ref:w,url:n.video_url,playing:r,muted:u,onProgress:S,onDuration:C,progressInterval:100})}),e.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-20",children:e.jsx(b,{to:"/dashboard",children:e.jsx(h,{variant:"outline",size:"icon",className:"w-9 h-9 sm:w-10 sm:h-10 text-foreground border-border hover:bg-accent hover:text-accent-foreground rounded-full shadow-md",children:e.jsx(q,{className:"w-4 h-4 sm:w-5 sm:h-5"})})})}),e.jsx("div",{className:"absolute top-3 right-3 flex items-center gap-2 z-20",children:e.jsx(h,{onClick:z,variant:"ghost",size:"icon",className:"w-9 h-9 sm:w-10 sm:h-10 text-foreground hover:bg-accent hover:text-accent-foreground",children:L?e.jsx(H,{className:"w-4 h-4 sm:w-5 sm:h-5 text-primary"}):e.jsx(_,{className:"w-4 h-4 sm:w-5 sm:h-5"})})}),e.jsx("div",{className:"w-full h-full flex flex-col justify-center items-center",children:e.jsx(O,{lyrics:P,currentTime:g})}),e.jsxs("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 w-full max-w-md sm:max-w-xl z-20",children:[" ",e.jsxs("div",{className:"flex items-center justify-center gap-3 sm:gap-4 mt-4 p-2 bg-card/80 rounded-full shadow-lg backdrop-blur-md border border-border/50",children:[" ",e.jsx(h,{onClick:()=>d(!r),variant:"ghost",size:"icon",className:"w-9 h-9 sm:w-10 sm:h-10 text-foreground hover:bg-accent hover:text-accent-foreground",children:r?e.jsx(B,{className:"w-5 h-5 sm:w-6 sm:h-6"}):e.jsx(F,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsx("input",{type:"range",min:0,max:k,value:g,onChange:m=>{var x;return(x=w.current)==null?void 0:x.seekTo(parseFloat(m.target.value))},className:"w-full h-1.5 bg-muted rounded-lg appearance-none cursor-pointer range-sm accent-primary"}),e.jsx(h,{onClick:()=>f(!u),variant:"ghost",size:"icon",className:"w-9 h-9 sm:w-10 sm:h-10 text-foreground hover:bg-accent hover:text-accent-foreground",children:u?e.jsx(K,{className:"w-5 h-5 sm:w-6 sm:h-6"}):e.jsx(X,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]})]})]})]}):e.jsx(y,{message:"Something went wrong."})};export{ee as default};
