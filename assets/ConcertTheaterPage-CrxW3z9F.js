import{j as e,r as c,a6 as D,a7 as H,a8 as G,a9 as ne,$ as ae,b as oe,m as le,a5 as ie,w as ce,a as L,H as de,B as E}from"./main-CivNnYL8.js";import{A as me}from"./arrow-left-CxyQXc3_.js";import{C as ue}from"./copy-DhwasAQ_.js";import{L as he}from"./log-out-CIp6zt3s.js";const ge=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})}),W=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"})}),xe=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.25 9.75 19.5 12m0 0 2.25 2.25M19.5 12l2.25-2.25M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"})}),O=["https://de1.api.radio-browser.info","https://nl1.api.radio-browser.info","https://at1.api.radio-browser.info"];let y=[],I=null,T=0;const fe=async()=>{try{const t=await fetch("https://all.api.radio-browser.info/json/servers");if(!t.ok)throw new Error(`Failed to fetch server list: ${t.statusText}`);const r=(await t.json()).filter(a=>a.lastcheckok===1).sort((a,l)=>l.votes-a.votes).map(a=>`https://${a.name}`);r.length>0?y=r:y=[...O]}catch{y=[...O]}},pe=()=>(I||(I=fe()),I),S=async t=>{await pe();const s=y.length;if(s===0)throw new Error("No API servers available to fetch from.");let r=null;for(let a=0;a<s;a++){const o=`${y[T]}/json/${t}`;try{const n=await fetch(o,{signal:AbortSignal.timeout(8e3)});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const i=await n.json();if(Array.isArray(i)&&i.length===0)return i;if(!Array.isArray(i))throw new Error("Invalid response from mirror");return i}catch(n){r=n instanceof Error?n:new Error(String(n)),T=(T+1)%y.length}}throw new Error(`All API mirrors failed. Last error: ${r==null?void 0:r.message}`)},be=async()=>(await S("languages?hidebroken=true&order=stationcount&reverse=true")).map(s=>s.name).filter(s=>s.trim()!==""),we=async()=>(await S("countries?hidebroken=true&order=stationcount&reverse=true")).map(s=>s.name).filter(s=>s.trim()!==""),je=async(t=150)=>(await S(`tags?hidebroken=true&order=stationcount&reverse=true&limit=${t}`)).map(r=>r.name).filter(r=>r.trim()!==""),q=t=>{const s=["MP3","AAC","OGG","FLAC","OPUS","WMA","WAV"];return t.filter(r=>{var l;if(r.hls===1)return!0;const a=((l=r.codec)==null?void 0:l.toUpperCase())||"";return a===""?!0:s.some(o=>a.includes(o))})},ve=async(t=100)=>{const s=await S(`stations/topclick/${t}?hidebroken=true`);return q(s)},ye=async(t,s=100)=>{const r=new URLSearchParams({limit:String(s),hidebroken:"true",order:"clickcount",reverse:"true"});t.name&&r.set("name",t.name),t.language&&r.set("language",t.language),t.country&&r.set("country",t.country),t.tag&&r.set("tag",t.tag);const a=await S(`stations/search?${r.toString()}`);return q(a)},Ne=({onSearch:t,onClear:s,isLoading:r,initialQuery:a,className:l})=>{const[o,n]=c.useState(a),i=d=>{d.preventDefault(),t(o.trim())},h=()=>{n(""),s()};return e.jsxs("form",{onSubmit:i,className:`relative w-full ${l||""}`,children:[" ",e.jsxs("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2.5 sm:pl-3",children:[" ",e.jsx(ge,{className:"h-4 w-4 sm:h-5 w-5 text-muted-foreground"})," "]}),e.jsx("input",{type:"search",value:o,onChange:d=>n(d.target.value),className:"block w-full rounded-md border-0 bg-input/50 py-2 sm:py-2.5 pl-9 pr-9 sm:pl-10 sm:pr-10 text-foreground shadow-sm ring-1 ring-inset ring-border/50 placeholder:text-muted-foreground focus:ring-2 focus:ring-inset focus:ring-primary text-sm sm:text-base sm:leading-6 transition-all",placeholder:"Search for a station...",disabled:r}),o&&e.jsxs("button",{type:"button",onClick:h,className:"absolute inset-y-0 right-0 flex items-center pr-2.5 sm:pr-3",children:[e.jsx(D,{className:"h-4 w-4 sm:h-5 w-5 text-muted-foreground hover:text-foreground"})," "]})]})},Se=({station:t,isPlaying:s,onSelect:r})=>{var h;const a=()=>e.jsx(G,{className:"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 text-muted-foreground"}),l=d=>{var f;const g=d.currentTarget;g.style.display="none";const x=(f=g.parentElement)==null?void 0:f.querySelector(".fallback-icon");x&&x.classList.remove("hidden")},o=d=>d?d.charAt(0).toUpperCase()+d.slice(1):"",n=(h=t.language)==null?void 0:h.split(",")[0].trim(),i=t.country||"Global";return e.jsxs("div",{onClick:r,className:`group relative flex flex-col p-2 sm:p-3 md:p-4 text-center bg-card/60 backdrop-blur-md rounded-xl sm:rounded-2xl shadow-lg cursor-pointer transition-all duration-300 ease-in-out transform hover:-translate-y-1 hover:shadow-primary/30 ${s?"ring-2 ring-offset-2 ring-offset-background ring-primary":"ring-1 ring-border/50"} items-center`,children:[s&&e.jsxs("div",{className:"absolute top-1.5 right-1.5 sm:top-2 sm:right-2 bg-primary text-primary-foreground text-xs font-bold px-1.5 py-0.5 rounded-full flex items-center gap-1 shadow-lg z-10",children:[" ",e.jsx("div",{className:"w-1.5 h-1.5 bg-primary-foreground rounded-full animate-pulse"})," ",e.jsx("span",{children:"On Air"})]}),e.jsxs("div",{className:"relative w-14 h-14 sm:w-16 sm:h-16 md:w-24 md:h-24 mb-2 sm:mb-3 md:mb-4",children:[" ",e.jsxs("div",{className:"relative w-full h-full rounded-full bg-input/50 flex items-center justify-center overflow-hidden ring-3 ring-border/50 group-hover:ring-primary/50 transition-all duration-300",children:[" ",e.jsx("img",{src:t.favicon,alt:`${t.name} logo`,className:"w-full h-full object-cover",onError:l}),e.jsx("div",{className:"fallback-icon hidden absolute inset-0 w-full h-full flex items-center justify-center",children:e.jsx(a,{})})]}),e.jsx("div",{className:"absolute inset-0 bg-black/60 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:s?e.jsx(W,{className:"w-7 h-7 sm:w-8 h-8 md:w-10 md:h-10 text-primary-foreground/90"}):e.jsx(H,{className:"w-7 h-7 sm:w-8 h-8 md:w-10 md:h-10 text-primary-foreground/90"})})]}),e.jsxs("div",{className:"w-full px-1",children:[e.jsx("h3",{className:"font-bold text-sm md:text-base text-foreground leading-tight truncate",title:t.name,children:t.name}),e.jsxs("div",{className:"mt-0.5 space-y-0.5",children:[" ",e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground truncate",title:i,children:i})," ",n&&e.jsx("p",{className:"text-xs text-muted-foreground/80 truncate",title:o(n),children:o(n)})]})]})]})},ke=()=>e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 sm:gap-4",children:[" ",Array.from({length:10}).map((t,s)=>e.jsxs("div",{className:"flex flex-col p-2 sm:p-3 md:p-4 bg-card/60 backdrop-blur-md rounded-xl sm:rounded-2xl animate-pulse aspect-square items-center justify-center shadow-lg",children:[" ",e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 md:w-24 md:h-24 rounded-full bg-muted/50 mb-2 sm:mb-3 md:mb-4"})," ",e.jsx("div",{className:"h-2.5 md:h-4 bg-muted/50 rounded w-3/4 mb-1.5 sm:mb-2"})," ",e.jsx("div",{className:"h-2 md:h-3 bg-muted/50 rounded w-1/2"})," "]},s))]}),Ce=({stations:t,onSelectStation:s,currentStation:r,isLoading:a,error:l})=>a?e.jsx(ke,{}):l?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 sm:h-64 text-center text-muted-foreground",children:[" ",e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-destructive",children:"Oops! Something went wrong."})," ",e.jsx("p",{className:"text-sm sm:text-base",children:l})," "]}):t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 sm:h-64 text-center text-muted-foreground",children:[" ",e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-foreground",children:"No Stations Found"})," ",e.jsx("p",{className:"text-sm sm:text-base",children:"Try a different search term or check back later."})," "]}):e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 sm:gap-4",children:[" ",t.map(o=>e.jsx(Se,{station:o,isPlaying:(r==null?void 0:r.stationuuid)===o.stationuuid,onSelect:()=>s(o)},o.stationuuid))]}),Ae=({station:t,isPlaying:s,onSetPlaying:r,onClear:a,onShowStation:l})=>{var w;const[o,n]=c.useState(!1),i=()=>{r()},h=()=>{a()},d=()=>{n(u=>!u)},g=u=>u?u.charAt(0).toUpperCase()+u.slice(1):"",x=(w=t.language)==null?void 0:w.split(",")[0].trim(),f=t.country||"Global";return e.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-50",children:e.jsxs("div",{className:"bg-card/80 backdrop-blur-lg border-t border-border/50 shadow-2xl p-3 sm:p-4",children:[" ",e.jsxs("div",{className:"container mx-auto flex items-center justify-between gap-3 sm:gap-4",children:[" ",e.jsxs("button",{onClick:()=>l(t),className:"flex items-center gap-3 flex-1 min-w-0 text-left rounded-md hover:bg-accent/20 p-1.5 sm:p-2 -m-1.5 sm:-m-2 transition-colors",title:"Find this station in the list",children:[e.jsx("img",{src:t.favicon,alt:t.name,className:"w-12 h-12 sm:w-14 h-14 rounded-md shadow-md bg-input/50",onError:u=>{const k=u.currentTarget;k.style.display="none";const N=k.nextElementSibling;N&&N.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden w-12 h-12 sm:w-14 h-14 rounded-md shadow-md bg-input/50 flex items-center justify-center",children:[" ",e.jsx(G,{className:"w-7 h-7 sm:w-8 h-8 text-muted-foreground"})," "]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground truncate text-sm sm:text-base",title:t.name,children:t.name})," ",e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground truncate",title:f,children:f})," ",x&&e.jsx("p",{className:"text-xs text-muted-foreground/80 truncate",title:g(x),children:g(x)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[" ",e.jsxs("button",{onClick:d,title:o?"Unmute":"Mute",className:"bg-input/50 hover:bg-accent/20 rounded-full p-2.5 sm:p-3 text-foreground transition-colors focus:outline-none focus:ring-2 focus:ring-border/50",children:[" ",o?e.jsx(xe,{className:"w-5 h-5 sm:w-6 h-6"}):e.jsx(W,{className:"w-5 h-5 sm:w-6 h-6"})," "]}),e.jsxs("button",{onClick:i,title:s?"Pause":"Play",className:"bg-primary hover:bg-primary/90 rounded-full p-2.5 sm:p-3 text-primary-foreground transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-background",children:[" ",s?e.jsx(ne,{className:"w-5 h-5 sm:w-6 h-6"}):e.jsx(H,{className:"w-5 h-5 sm:w-6 h-6"})," "]}),e.jsxs("button",{onClick:h,title:"Stop and clear player",className:"bg-input/50 hover:bg-accent/20 rounded-full p-1.5 sm:p-2 text-muted-foreground hover:text-foreground transition-colors focus:outline-none focus:ring-2 focus:ring-border/50",children:[" ",e.jsx(D,{className:"w-4 h-4 sm:w-5 h-5"})," "]})]})]})]})})},$=({label:t,id:s,options:r,value:a,onChange:l,disabled:o})=>e.jsxs("div",{className:"flex-1 min-w-[120px] sm:min-w-[140px]",children:[" ",e.jsx("label",{htmlFor:s,className:"sr-only",children:t}),e.jsxs("select",{id:s,name:s,value:a,onChange:n=>l(s,n.target.value),disabled:o||r.length===0,className:"block w-full rounded-md border-0 bg-input/50 py-1.5 pl-2.5 pr-6 sm:py-2 sm:pl-3 sm:pr-8 text-foreground shadow-sm ring-1 ring-inset ring-border/50 placeholder:text-muted-foreground focus:ring-2 focus:ring-inset focus:ring-primary text-sm sm:text-base sm:leading-6 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsxs("option",{value:"",children:["All ",t,"s"]}),r.map(n=>e.jsx("option",{value:n,children:n.charAt(0).toUpperCase()+n.slice(1)},n))]})]}),Le=({languages:t,countries:s,tags:r,selectedLanguage:a,selectedCountry:l,selectedTag:o,onFilterChange:n,isLoading:i})=>e.jsxs("div",{className:"flex flex-wrap w-full md:w-auto items-center gap-2 md:gap-3",children:[e.jsx($,{label:"Language",id:"language",options:t,value:a,onChange:n,disabled:i}),e.jsx($,{label:"Country",id:"country",options:s,value:l,onChange:n,disabled:i}),e.jsx($,{label:"Category",id:"tag",options:r,value:o,onChange:n,disabled:i})]}),Fe=()=>{const{roomCode:t}=ae(),s=oe(),{user:r,loading:a}=le(),{currentStation:l,isPlaying:o,roomCode:n,setRoom:i,setStation:h,togglePlay:d,clearStation:g}=ie(),[x,f]=c.useState([]),[w,u]=c.useState(!0),[k,N]=c.useState(null),[j,P]=c.useState(""),[C,F]=c.useState(""),[A,U]=c.useState(""),[b,M]=c.useState(""),[Q,Z]=c.useState([]),[_,V]=c.useState([]),[Y,X]=c.useState([]),[Pe,R]=c.useState(!1);c.useEffect(()=>{t&&i(t)},[t,i]),c.useEffect(()=>{(async()=>{try{const[p,z,v]=await Promise.all([be(),we(),je(150)]);Z(p),V(z),X(v)}catch(p){console.error("Failed to load filter options",p)}})()},[]),c.useEffect(()=>{const m=setTimeout(()=>{u(!0),N(null),(j||C||A||b?ye({name:j,language:C,country:A,tag:b}):ve(100)).then(v=>{f(v)}).catch(v=>{N(v instanceof Error?v.message:"An unknown error occurred."),f([])}).finally(()=>{u(!1)})},200);return()=>clearTimeout(m)},[j,C,A,b]);const J=m=>{m.url_resolved?h(m):L.error(`Station ${m.name} does not have a valid stream URL.`)},K=()=>{t&&(navigator.clipboard.writeText(t),R(!0),L.success("Room code copied!"),setTimeout(()=>R(!1),2e3))},ee=m=>{P(m.name),F(""),U(""),M("")},te=()=>{s("/dashboard")},se=()=>{g(),i(null),s("/dashboard"),L.info("You have left the Concert.")},re=()=>j?`Results for "${j}"`:b?`${b.charAt(0).toUpperCase()+b.slice(1)} Stations`:"Popular Stations";if(a)return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background text-foreground",children:[e.jsx(ce,{}),e.jsx("p",{className:"text-xl mt-4",children:"Loading Session..."})]});if(!r)return L.error("You must be logged in to enter a Concert."),s("/login"),null;if(!t)return s("/concert"),null;const B=n===t;return e.jsxs(e.Fragment,{children:[e.jsxs(de,{children:[e.jsx("title",{children:`Concert ${t} - Anbae`})," ",e.jsx("meta",{name:"description",content:`Listen to internet radio with your partner in Concert ${t}.`})," "]}),e.jsxs("div",{className:"h-screen w-screen bg-background text-foreground flex flex-col antialiased",children:[e.jsxs("main",{className:"flex-grow overflow-y-auto pb-28 sm:pb-32",children:[" ",e.jsxs("header",{className:"bg-background p-3 sm:p-4",children:[" ",e.jsxs("div",{className:"container mx-auto flex items-start justify-between gap-2 sm:gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(E,{onClick:te,variant:"outline",size:"icon",className:"w-9 h-9 sm:w-10 sm:h-10 text-foreground border-border hover:bg-accent hover:text-accent-foreground rounded-full shadow-md","aria-label":"Back to Dashboard",children:e.jsx(me,{className:"w-4 h-4 sm:w-5 sm:h-5"})})}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Concert"})," ",e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 bg-input/50 rounded-md p-1.5 sm:p-2 border border-border/50",children:[e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground hidden md:inline",children:"CODE:"}),e.jsx("span",{className:"font-bold tracking-widest text-sm sm:text-base text-foreground",children:t}),e.jsx(E,{onClick:K,variant:"ghost",size:"icon",className:"w-7 h-7 text-muted-foreground hover:text-foreground hover:bg-accent/20",children:e.jsx(ue,{className:"w-4 h-4"})})]}),e.jsx(E,{onClick:se,variant:"destructive",size:"icon",className:"w-9 h-9 sm:w-10 sm:h-10 bg-destructive hover:bg-destructive/90 text-destructive-foreground rounded-full shadow-md",children:e.jsx(he,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]})]})]}),e.jsxs("div",{className:"container mx-auto p-3 sm:p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-3 sm:mb-4 gap-3 sm:gap-4",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-foreground flex-shrink-0 order-1 md:order-none",children:re()}),e.jsx(Le,{languages:Q,countries:_,tags:Y,selectedLanguage:C,selectedCountry:A,selectedTag:b,onFilterChange:(m,p)=>{m==="language"&&F(p),m==="country"&&U(p),m==="tag"&&M(p)},isLoading:w})]}),e.jsx(Ne,{onSearch:P,isLoading:w,initialQuery:j,onClear:()=>P(""),className:"mb-6 sm:mb-8"}),e.jsx(Ce,{stations:x,onSelectStation:J,currentStation:B?l:null,isLoading:w,error:k})]})]}),B&&l&&e.jsx(Ae,{station:l,isPlaying:o,onSetPlaying:d,onClear:g,onShowStation:ee})]})]})};export{Fe as default};
