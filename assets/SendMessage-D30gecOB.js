import{b as T,n as V,r as i,j as e,x as B,H as _,L as b,B as f,d as U,a,s as D}from"./main-DjNC3G64.js";import{u as q,F as Y,a as d,b as c,c as x,d as u,e as h,t as R,o as W,f as j,s as z}from"./form-CKMLyXiC.js";import{T as J}from"./textarea-CY6IaKIv.js";import{S as y,a as N,b as v,c as w,d as s}from"./select-BWmIXSgJ.js";import{f as K}from"./supabaseHelpers-DuDpU6fp.js";import{B as O}from"./BackgroundWrapper-B09iK6D5.js";import{H as C}from"./heart-Dm1EevTf.js";import{U as Q}from"./users-DyCn6oqI.js";import{M as F}from"./message-square-Bt1ugy7e.js";import{S as X}from"./send-DlU7Tlrp.js";import{A as Z}from"./arrow-left-CCXN5EYU.js";import"./label-BhBloIXZ.js";import"./index-DPQf-OcN.js";import"./index-BNhSlDgx.js";import"./check-J0izW_e_.js";const $=W({message_type:j(["Grievance","Compliment","Good Memory","How I Feel"],{required_error:"Please select a message type."}),content:z().min(1,{message:"Message content cannot be empty."}).max(1e3,{message:"Message is too long."}),priority:j(["Low","Medium","High","Urgent"],{required_error:"Please select a priority."}),mood:j(["Happy","Sad","Angry","Neutral","Anxious","Grateful"],{required_error:"Please select your mood."})}),pe=()=>{const S=T(),{user:t,loading:p}=V(),[g,k]=i.useState(null),[H,M]=i.useState(null),[A,P]=i.useState(!0),o=q({resolver:R($),defaultValues:{message_type:"Grievance",content:"",priority:"Medium",mood:"Neutral"}}),G=o.watch("message_type");i.useEffect(()=>{(async()=>{var n;if(p||!t){P(!1);return}const m=(n=t==null?void 0:t.user_metadata)==null?void 0:n.partner_email;if(m)try{const l=await K(m);l?(k(l.id),M(l.username)):(a.error("Partner profile not found for the specified email. Please ensure your partner has registered."),k(null),M(null))}catch{a.error("An unexpected error occurred while fetching partner details.")}else a.error("Your profile does not have a partner email set. Please update your profile.");P(!1)})()},[t,p]);const E=async r=>{if(!t||!g){a.error("Cannot send message: User or partner not identified.");return}const m=t.user_metadata.nickname||t.email;if(!m){a.error("Could not determine your author name. Please ensure you have a nickname set in your profile.");return}try{const{error:n}=await D.from("messages").insert({user_id:t.id,sender_id:t.id,receiver_id:g,author_name:m,subject:r.message_type,content:r.content,message_type:r.message_type,priority:r.priority,mood:r.mood});n?a.error(n.message):(a.success("Message sent successfully!"),S("/dashboard"))}catch{a.error("An unexpected error occurred while sending the message.")}};if(p||A)return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-background to-background/80 text-foreground",children:[e.jsx(B,{}),e.jsx("p",{className:"text-xl mt-4",children:"Loading..."})]});if(!t)return S("/login"),null;const L=t.user_metadata.partner_email||"Not set";if(!g)return e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:[e.jsx("title",{children:"Send Message - Anbae"}),e.jsx("meta",{name:"description",content:"Send a message to your partner. Choose message type, content, priority, and mood."})]}),e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-background to-background/80 p-4 text-center pt-20",children:[e.jsx(C,{className:"w-10 h-10 sm:w-12 sm:h-12 text-primary mx-auto mb-3 sm:mb-4"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-foreground mb-3 sm:mb-4",children:"Partner Not Found"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-2",children:"It looks like your partner's profile isn't set up or linked."}),e.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground mb-5 sm:mb-6",children:["Your current partner email is: ",e.jsx("strong",{className:"text-foreground",children:L}),". Please ensure your partner has registered with this exact email, or update it in your profile."]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsx(b,{to:"/edit-profile",children:e.jsxs(f,{className:"bg-primary hover:bg-primary/90 text-primary-foreground text-sm sm:text-base px-4 py-2 sm:px-6 sm:py-3",children:[e.jsx(Q,{className:"w-4 h-4 sm:w-5 sm:h-5 mr-2"})," Edit Partner Email"]})}),e.jsx(b,{to:"/dashboard",children:e.jsx(f,{variant:"outline",className:"text-foreground border-border hover:bg-accent hover:text-accent-foreground text-sm sm:text-base px-4 py-2 sm:px-6 sm:py-3",children:"Back to Dashboard"})})]})]})]});const I=r=>{switch(r){case"Grievance":return"bg-destructive/20 dark:bg-destructive/20 border-destructive/50 dark:border-destructive/50";case"Compliment":return"bg-green-100/20 dark:bg-green-950/20 border-green-300/50 dark:border-green-700/50";case"Good Memory":return"bg-yellow-100/20 dark:bg-yellow-950/20 border-yellow-300/50 dark:border-yellow-700/50";case"How I Feel":return"bg-blue-100/20 dark:bg-blue-950/20 border-blue-300/50 dark:border-blue-700/50";default:return"bg-card/60 dark:bg-card/60 border-border/50 dark:border-border/50"}};return e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:[e.jsx("title",{children:"Send Message - Anbae"}),e.jsx("meta",{name:"description",content:"Send a message to your partner. Choose message type, content, priority, and mood."})]}),e.jsx(O,{children:e.jsxs("div",{className:U("w-full max-w-sm sm:max-w-md p-6 sm:p-8 rounded-xl shadow-lg backdrop-blur-md transition-colors duration-300",I(G)),children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(C,{className:"w-10 h-10 sm:w-12 sm:h-12 text-primary mx-auto mb-3 sm:mb-4"}),e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-1 sm:mb-2",children:"Send a Message"}),e.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground",children:["Share your thoughts with ",H||"your partner","."]})]}),e.jsx(Y,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(E),className:"space-y-5 sm:space-y-6",children:[e.jsx(d,{control:o.control,name:"message_type",render:({field:r})=>e.jsxs(c,{children:[e.jsxs(x,{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(F,{className:"w-4 h-4 text-primary"})," Message Type"]}),e.jsxs(y,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(u,{children:e.jsx(N,{className:"bg-input/50 border-border/50 text-foreground text-sm sm:text-base h-10",children:e.jsx(v,{placeholder:"Select a message type"})})}),e.jsxs(w,{className:"bg-card border-border text-foreground text-sm sm:text-base",children:[e.jsx(s,{value:"Grievance",children:"ğŸ’” Grievance"}),e.jsx(s,{value:"Compliment",children:"ğŸ’– Compliment"}),e.jsx(s,{value:"Good Memory",children:"âœ¨ Good Memory"}),e.jsx(s,{value:"How I Feel",children:"ğŸ¤” How I Feel"})]})]}),e.jsx(h,{className:"text-xs sm:text-sm"})]})}),e.jsx(d,{control:o.control,name:"content",render:({field:r})=>e.jsxs(c,{children:[e.jsxs(x,{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(F,{className:"w-4 h-4 text-primary"})," Explanation"]}),e.jsx(u,{children:e.jsx(J,{placeholder:"Explain the situation, how it makes you feel, and what you need.",...r,rows:4,className:"bg-input/50 border-border/50 text-foreground text-sm sm:text-base min-h-[80px] sm:min-h-[120px]"})}),e.jsx(h,{className:"text-xs sm:text-sm"})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(d,{control:o.control,name:"priority",render:({field:r})=>e.jsxs(c,{children:[e.jsx(x,{className:"flex items-center gap-2 text-sm sm:text-base",children:"Priority"}),e.jsxs(y,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(u,{children:e.jsx(N,{className:"bg-input/50 border-border/50 text-foreground text-sm sm:text-base h-10",children:e.jsx(v,{placeholder:"Select priority"})})}),e.jsxs(w,{className:"bg-card border-border text-foreground text-sm sm:text-base",children:[e.jsx(s,{value:"Low",children:"Low"}),e.jsx(s,{value:"Medium",children:"Medium"}),e.jsx(s,{value:"High",children:"High"}),e.jsx(s,{value:"Urgent",children:"Urgent"})]})]}),e.jsx(h,{className:"text-xs sm:text-sm"})]})}),e.jsx(d,{control:o.control,name:"mood",render:({field:r})=>e.jsxs(c,{children:[e.jsx(x,{className:"flex items-center gap-2 text-sm sm:text-base",children:"Your Mood"}),e.jsxs(y,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(u,{children:e.jsx(N,{className:"bg-input/50 border-border/50 text-foreground text-sm sm:text-base h-10",children:e.jsx(v,{placeholder:"Select your mood"})})}),e.jsxs(w,{className:"bg-card border-border text-foreground text-sm sm:text-base",children:[e.jsx(s,{value:"Happy",children:"ğŸ˜Š Happy"}),e.jsx(s,{value:"Sad",children:"ğŸ˜” Sad"}),e.jsx(s,{value:"Angry",children:"ğŸ˜  Angry"}),e.jsx(s,{value:"Neutral",children:"ğŸ˜ Neutral"}),e.jsx(s,{value:"Anxious",children:"ğŸ˜Ÿ Anxious"}),e.jsx(s,{value:"Grateful",children:"ğŸ™ Grateful"})]})]}),e.jsx(h,{className:"text-xs sm:text-sm"})]})})]}),e.jsxs(f,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground text-sm sm:text-base py-2 sm:py-2.5",children:[e.jsx(X,{className:"w-4 h-4 mr-2"})," Send Message"]})]})}),e.jsx("div",{className:"mt-5 sm:mt-6 text-center",children:e.jsxs(b,{to:"/dashboard",className:"text-xs sm:text-sm text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(Z,{className:"inline-block w-4 h-4 mr-1"})," Back to Dashboard"]})})]})})]})};export{pe as default};
