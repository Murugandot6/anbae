import{t as re,r as l,J as Fe,j as e,z as te,P as E,v as T,q as Re,y as se,O as Ae,C as Me,d as A,l as Ee,b as Se,s as k,a as P,H as ke,T as Pe,m as Ge,B as Le,n as De,L as V,U as q}from"./main-BHPIGV8h.js";import{C as z,a as H,b as Y,c as W}from"./card-CN1N3ooC.js";import{u as ae}from"./index-CBatG-58.js";import{a as J}from"./supabaseHelpers-CPJLcMFB.js";import{A as Q,a as X,b as Z}from"./avatar-M7QsreIS.js";import{B as G,C as Be}from"./badge-Bop49VJa.js";import{B as Oe}from"./BackgroundWrapper-C6a75pID.js";import{A as Ue}from"./arrow-left-C4HDbgt0.js";import{M as Ke}from"./mail-D4aJpkB7.js";import{S as $e}from"./send-ChfChDUX.js";import{M as ee}from"./message-square-vNVwtfba.js";var B="rovingFocusGroup.onEntryFocus",Ve={bubbles:!1,cancelable:!0},S="RovingFocusGroup",[O,oe,qe]=Fe(S),[ze,ne]=re(S,[qe]),[He,Ye]=ze(S),ie=l.forwardRef((r,s)=>e.jsx(O.Provider,{scope:r.__scopeRovingFocusGroup,children:e.jsx(O.Slot,{scope:r.__scopeRovingFocusGroup,children:e.jsx(We,{...r,ref:s})})}));ie.displayName=S;var We=l.forwardRef((r,s)=>{const{__scopeRovingFocusGroup:n,orientation:o,loop:g=!1,dir:x,currentTabStopId:f,defaultCurrentTabStopId:w,onCurrentTabStopIdChange:y,onEntryFocus:v,preventScrollOnEntryFocus:u=!1,...b}=r,h=l.useRef(null),_=Re(s,h),I=ae(x),[t,i]=se({prop:f,defaultProp:w??null,onChange:y,caller:S}),[c,m]=l.useState(!1),a=Ae(v),d=oe(n),N=l.useRef(!1),[C,F]=l.useState(0);return l.useEffect(()=>{const j=h.current;if(j)return j.addEventListener(B,a),()=>j.removeEventListener(B,a)},[a]),e.jsx(He,{scope:n,orientation:o,dir:I,loop:g,currentTabStopId:t,onItemFocus:l.useCallback(j=>i(j),[i]),onItemShiftTab:l.useCallback(()=>m(!0),[]),onFocusableItemAdd:l.useCallback(()=>F(j=>j+1),[]),onFocusableItemRemove:l.useCallback(()=>F(j=>j-1),[]),children:e.jsx(E.div,{tabIndex:c||C===0?-1:0,"data-orientation":o,...b,ref:_,style:{outline:"none",...r.style},onMouseDown:T(r.onMouseDown,()=>{N.current=!0}),onFocus:T(r.onFocus,j=>{const D=!N.current;if(j.target===j.currentTarget&&D&&!c){const p=new CustomEvent(B,Ve);if(j.currentTarget.dispatchEvent(p),!p.defaultPrevented){const M=d().filter(R=>R.focusable),Ce=M.find(R=>R.active),_e=M.find(R=>R.id===t),Ie=[Ce,_e,...M].filter(Boolean).map(R=>R.ref.current);le(Ie,u)}}N.current=!1}),onBlur:T(r.onBlur,()=>m(!1))})})}),ce="RovingFocusGroupItem",de=l.forwardRef((r,s)=>{const{__scopeRovingFocusGroup:n,focusable:o=!0,active:g=!1,tabStopId:x,children:f,...w}=r,y=te(),v=x||y,u=Ye(ce,n),b=u.currentTabStopId===v,h=oe(n),{onFocusableItemAdd:_,onFocusableItemRemove:I,currentTabStopId:t}=u;return l.useEffect(()=>{if(o)return _(),()=>I()},[o,_,I]),e.jsx(O.ItemSlot,{scope:n,id:v,focusable:o,active:g,children:e.jsx(E.span,{tabIndex:b?0:-1,"data-orientation":u.orientation,...w,ref:s,onMouseDown:T(r.onMouseDown,i=>{o?u.onItemFocus(v):i.preventDefault()}),onFocus:T(r.onFocus,()=>u.onItemFocus(v)),onKeyDown:T(r.onKeyDown,i=>{if(i.key==="Tab"&&i.shiftKey){u.onItemShiftTab();return}if(i.target!==i.currentTarget)return;const c=Xe(i,u.orientation,u.dir);if(c!==void 0){if(i.metaKey||i.ctrlKey||i.altKey||i.shiftKey)return;i.preventDefault();let a=h().filter(d=>d.focusable).map(d=>d.ref.current);if(c==="last")a.reverse();else if(c==="prev"||c==="next"){c==="prev"&&a.reverse();const d=a.indexOf(i.currentTarget);a=u.loop?Ze(a,d+1):a.slice(d+1)}setTimeout(()=>le(a))}}),children:typeof f=="function"?f({isCurrentTabStop:b,hasTabStop:t!=null}):f})})});de.displayName=ce;var Je={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Qe(r,s){return s!=="rtl"?r:r==="ArrowLeft"?"ArrowRight":r==="ArrowRight"?"ArrowLeft":r}function Xe(r,s,n){const o=Qe(r.key,n);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(o))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(o)))return Je[o]}function le(r,s=!1){const n=document.activeElement;for(const o of r)if(o===n||(o.focus({preventScroll:s}),document.activeElement!==n))return}function Ze(r,s){return r.map((n,o)=>r[(s+o)%r.length])}var er=ie,rr=de,L="Tabs",[tr,vr]=re(L,[ne]),ue=ne(),[sr,$]=tr(L),fe=l.forwardRef((r,s)=>{const{__scopeTabs:n,value:o,onValueChange:g,defaultValue:x,orientation:f="horizontal",dir:w,activationMode:y="automatic",...v}=r,u=ae(w),[b,h]=se({prop:o,onChange:g,defaultProp:x??"",caller:L});return e.jsx(sr,{scope:n,baseId:te(),value:b,onValueChange:h,orientation:f,dir:u,activationMode:y,children:e.jsx(E.div,{dir:u,"data-orientation":f,...v,ref:s})})});fe.displayName=L;var me="TabsList",be=l.forwardRef((r,s)=>{const{__scopeTabs:n,loop:o=!0,...g}=r,x=$(me,n),f=ue(n);return e.jsx(er,{asChild:!0,...f,orientation:x.orientation,dir:x.dir,loop:o,children:e.jsx(E.div,{role:"tablist","aria-orientation":x.orientation,...g,ref:s})})});be.displayName=me;var ge="TabsTrigger",xe=l.forwardRef((r,s)=>{const{__scopeTabs:n,value:o,disabled:g=!1,...x}=r,f=$(ge,n),w=ue(n),y=he(f.baseId,o),v=je(f.baseId,o),u=o===f.value;return e.jsx(rr,{asChild:!0,...w,focusable:!g,active:u,children:e.jsx(E.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":v,"data-state":u?"active":"inactive","data-disabled":g?"":void 0,disabled:g,id:y,...x,ref:s,onMouseDown:T(r.onMouseDown,b=>{!g&&b.button===0&&b.ctrlKey===!1?f.onValueChange(o):b.preventDefault()}),onKeyDown:T(r.onKeyDown,b=>{[" ","Enter"].includes(b.key)&&f.onValueChange(o)}),onFocus:T(r.onFocus,()=>{const b=f.activationMode!=="manual";!u&&!g&&b&&f.onValueChange(o)})})})});xe.displayName=ge;var pe="TabsContent",ve=l.forwardRef((r,s)=>{const{__scopeTabs:n,value:o,forceMount:g,children:x,...f}=r,w=$(pe,n),y=he(w.baseId,o),v=je(w.baseId,o),u=o===w.value,b=l.useRef(u);return l.useEffect(()=>{const h=requestAnimationFrame(()=>b.current=!1);return()=>cancelAnimationFrame(h)},[]),e.jsx(Me,{present:g||u,children:({present:h})=>e.jsx(E.div,{"data-state":u?"active":"inactive","data-orientation":w.orientation,role:"tabpanel","aria-labelledby":y,hidden:!h,id:v,tabIndex:0,...f,ref:s,style:{...r.style,animationDuration:b.current?"0s":void 0},children:h&&x})})});ve.displayName=pe;function he(r,s){return`${r}-trigger-${s}`}function je(r,s){return`${r}-content-${s}`}var ar=fe,we=be,ye=xe,Ne=ve;const or=ar,Te=l.forwardRef(({className:r,...s},n)=>e.jsx(we,{ref:n,className:A("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...s}));Te.displayName=we.displayName;const U=l.forwardRef(({className:r,...s},n)=>e.jsx(ye,{ref:n,className:A("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...s}));U.displayName=ye.displayName;const K=l.forwardRef(({className:r,...s},n)=>e.jsx(Ne,{ref:n,className:A("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...s}));K.displayName=Ne.displayName;const hr=()=>{const{user:r,loading:s}=Ee(),n=Se(),[o,g]=l.useState([]),[x,f]=l.useState([]),[w,y]=l.useState(!0),[v,u]=l.useState(new Map),b=async t=>{if(v.has(t))return v.get(t);const i=await J(t);return i&&u(c=>new Map(c).set(t,i)),i};if(l.useEffect(()=>{!s&&r?(async()=>{if(!r){y(!1);return}y(!0);try{const{data:c,error:m}=await k.from("messages").select("*").eq("sender_id",r.id).is("parent_message_id",null).order("created_at",{ascending:!1});m&&P.error("Failed to load sent messages: "+m.message);const{data:a,error:d}=await k.from("messages").select("*").eq("receiver_id",r.id).is("parent_message_id",null).order("created_at",{ascending:!1});d&&P.error("Failed to load received messages: "+d.message);const N=new Set;c==null||c.forEach(p=>N.add(p.receiver_id)),a==null||a.forEach(p=>N.add(p.sender_id)),N.add(r.id);const C=[];for(const p of Array.from(N)){const M=await J(p);M&&C.push(M)}const F=new Map;C.forEach(p=>{F.set(p.id,p)}),u(F);const j=(c==null?void 0:c.map(p=>({...p,receiverProfile:F.get(p.receiver_id)||null})))||[],D=(a==null?void 0:a.map(p=>({...p,senderProfile:F.get(p.sender_id)||null})))||[];g(j),f(D)}catch{P.error("An unexpected error occurred while loading messages.")}finally{y(!1)}})():!s&&!r&&n("/login");const i=k.channel("messages_channel").on("postgres_changes",{event:"*",schema:"public",table:"messages",filter:`sender_id=eq.${r==null?void 0:r.id}.or.receiver_id=eq.${r==null?void 0:r.id}`},async c=>{const m=c.new;if(m.parent_message_id===null)if(c.eventType==="INSERT"){const a=await b(m.sender_id),d=await b(m.receiver_id),N={...m,senderProfile:a,receiverProfile:d};m.receiver_id===(r==null?void 0:r.id)?(f(C=>[N,...C]),P.info(`New message from ${(a==null?void 0:a.username)||(a==null?void 0:a.email)||"Your Partner"}!`)):m.sender_id===(r==null?void 0:r.id)&&g(C=>[N,...C])}else c.eventType==="UPDATE"&&(f(a=>a.map(d=>d.id===m.id?{...d,...m}:d)),g(a=>a.map(d=>d.id===m.id?{...d,...m}:d)))}).subscribe();return()=>{k.removeChannel(i)}},[r,s,n]),s||w)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-background/80 text-foreground",children:e.jsx("p",{className:"text-xl",children:"Loading messages..."})});if(!r)return n("/login"),null;const h=t=>{switch(t){case"Grievance":return"bg-destructive/20 dark:bg-destructive/20 border-destructive/50 dark:border-destructive/50";case"Compliment":return"bg-green-100/20 dark:bg-green-950/20 border-green-300/50 dark:border-green-700/50";case"Good Memory":return"bg-yellow-100/20 dark:bg-yellow-950/20 border-yellow-300/50 dark:border-yellow-700/50";case"How I Feel":return"bg-blue-100/20 dark:bg-blue-950/20 border-blue-300/50 dark:border-blue-700/50";default:return"bg-card/20 dark:bg-card/20 border-border/50 dark:border-border/50"}},_=t=>{switch(t){case"Grievance":return"ðŸ’”";case"Compliment":return"ðŸ’–";case"Good Memory":return"âœ¨";case"How I Feel":return"ðŸ¤”";default:return""}},I=t=>h(t);return e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx("title",{children:"Messages - Anbae"}),e.jsx("meta",{name:"description",content:"View your sent and received messages with your partner on Anbae. Keep track of your conversations."})]}),e.jsx(Oe,{className:"pt-0 md:pt-0",children:e.jsxs("div",{className:"w-full max-w-2xl mx-auto pt-8 mt-16 md:mt-8",children:[" ",e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("div",{className:"absolute top-4 left-4 z-10",children:e.jsxs(Pe,{children:[e.jsx(Ge,{asChild:!0,children:e.jsx(Le,{variant:"outline",size:"icon",className:"w-10 h-10 text-foreground border-border hover:bg-accent hover:text-accent-foreground rounded-full shadow-md",onClick:()=>{n("/dashboard",{replace:!0})},children:e.jsx(Ue,{className:"w-5 h-5"})})}),e.jsx(De,{children:"Back to Dashboard"})]})}),e.jsx("h1",{className:"text-3xl font-bold text-foreground mx-auto",children:"Your Messages"})]}),e.jsxs(or,{defaultValue:"inbox",className:"w-full",children:[e.jsxs(Te,{className:"grid w-full grid-cols-2 mb-6 bg-card/60 backdrop-blur-md border border-border/50 rounded-xl",children:[e.jsxs(U,{value:"inbox",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-md rounded-lg transition-all duration-200",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"})," Inbox (",x.length,")"]}),e.jsxs(U,{value:"outbox",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-md rounded-lg transition-all duration-200",children:[e.jsx($e,{className:"w-4 h-4 mr-2"})," Outbox (",o.length,")"]})]}),e.jsx(K,{value:"inbox",children:e.jsxs(z,{className:"bg-card/60 dark:bg-card/60 shadow-lg backdrop-blur-md border border-border/50 rounded-xl",children:[e.jsx(H,{children:e.jsx(Y,{className:"text-foreground",children:"Received Messages"})}),e.jsx(W,{className:"text-muted-foreground",children:x.length>0?e.jsx("ul",{className:"space-y-4",children:x.map(t=>{var i,c,m,a,d;return e.jsx("li",{className:A("relative border-b border-border/30 pb-2 last:border-b-0 max-w-2xl mx-auto p-2 rounded-xl transition-all duration-300 hover:scale-[1.01] hover:shadow-md",h(t.message_type)),children:e.jsxs(V,{to:`/messages/${t.id}`,className:"block hover:bg-opacity-80 rounded-md transition-colors flex items-center gap-3",children:[e.jsx("span",{className:A("absolute -top-4 -left-4 text-2xl z-10 w-10 h-10 flex items-center justify-center rounded-full shadow-md",I(t.message_type)),children:_(t.message_type)}),e.jsxs(Q,{className:"w-12 h-12 ml-8 border-2 border-primary",children:[e.jsx(X,{src:((i=t.senderProfile)==null?void 0:i.avatar_url)||"",alt:"Sender Avatar"}),e.jsx(Z,{className:"bg-primary text-primary-foreground",children:((m=(c=t.senderProfile)==null?void 0:c.username)==null?void 0:m.charAt(0).toUpperCase())||((d=(a=t.senderProfile)==null?void 0:a.email)==null?void 0:d.charAt(0).toUpperCase())})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-lg text-foreground mb-1 flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-primary"}),t.subject]}),e.jsxs("span",{className:"flex items-center gap-2 text-sm text-muted-foreground flex-shrink-0",children:[t.is_read?null:e.jsx(G,{className:"bg-accent text-accent-foreground text-xs font-bold",children:"NEW!"}),t.status==="closed"&&e.jsx(G,{variant:"secondary",className:"bg-muted text-muted-foreground",children:"Closed"})]})]}),e.jsx("p",{className:"text-sm text-foreground line-clamp-2",children:t.content}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:q(t.created_at)})]})]})},t.id)})}):e.jsx("p",{children:"No messages received yet."})})]})}),e.jsx(K,{value:"outbox",children:e.jsxs(z,{className:"bg-card/60 dark:bg-card/60 shadow-lg backdrop-blur-md border border-border/50 rounded-xl",children:[e.jsx(H,{children:e.jsx(Y,{className:"text-foreground",children:"Sent Messages"})}),e.jsx(W,{className:"text-muted-foreground",children:o.length>0?e.jsx("ul",{className:"space-y-4",children:o.map(t=>{var i,c,m,a,d;return e.jsx("li",{className:A("relative border-b border-border/30 pb-2 last:border-b-0 max-w-2xl mx-auto p-2 rounded-xl transition-all duration-300 hover:scale-[1.01] hover:shadow-md",h(t.message_type)),children:e.jsxs(V,{to:`/messages/${t.id}`,className:"block hover:bg-opacity-80 rounded-md transition-colors flex items-center gap-3",children:[e.jsx("span",{className:A("absolute -top-4 -left-4 text-2xl z-10 w-10 h-10 flex items-center justify-center rounded-full shadow-md",I(t.message_type)),children:_(t.message_type)}),e.jsxs(Q,{className:"w-12 h-12 ml-8 border-2 border-primary",children:[e.jsx(X,{src:((i=t.receiverProfile)==null?void 0:i.avatar_url)||"",alt:"Receiver Avatar"}),e.jsx(Z,{className:"bg-primary text-primary-foreground",children:((m=(c=t.receiverProfile)==null?void 0:c.username)==null?void 0:m.charAt(0).toUpperCase())||((d=(a=t.receiverProfile)==null?void 0:a.email)==null?void 0:d.charAt(0).toUpperCase())})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-lg text-foreground mb-1 flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-primary"}),t.subject]}),e.jsxs("span",{className:"flex items-center gap-2 text-sm text-muted-foreground flex-shrink-0",children:[t.read_at&&e.jsxs(G,{className:"bg-accent text-accent-foreground text-xs font-bold flex items-center gap-1",children:[e.jsx(Be,{className:"w-4 h-4"})," Read"]}),t.status==="closed"&&e.jsx(G,{variant:"secondary",className:"bg-muted text-muted-foreground",children:"Closed"})]})]}),e.jsx("p",{className:"text-sm text-foreground line-clamp-2",children:t.content}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:q(t.created_at)})]})]})},t.id)})}):e.jsx("p",{children:"No messages sent yet."})})]})})]})]})})]})};export{hr as default};
