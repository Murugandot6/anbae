import{b as T,l as V,r as d,j as e,H as _,L as f,B as b,d as B,a as t,s as U}from"./main-BHPIGV8h.js";import{u as D,F as q,a as c,b as m,c as u,d as x,e as g,t as Y,o as R,f as j,s as W}from"./form-Bb0e-UzI.js";import{T as z}from"./textarea-DDVBgeYU.js";import{S as y,a as N,b as v,c as w,d as s}from"./select-BVSOCHce.js";import{f as J}from"./supabaseHelpers-CPJLcMFB.js";import{B as K}from"./BackgroundWrapper-C6a75pID.js";import{H as C}from"./heart-C5xyn10g.js";import{U as O}from"./users-D5Y8rFmf.js";import{M as F}from"./message-square-vNVwtfba.js";import{S as Q}from"./send-ChfChDUX.js";import{A as X}from"./arrow-left-C4HDbgt0.js";import"./index-CBatG-58.js";import"./index-CIk3TtyT.js";import"./check-CszRzhCn.js";const Z=R({message_type:j(["Grievance","Compliment","Good Memory","How I Feel"],{required_error:"Please select a message type."}),content:W().min(1,{message:"Message content cannot be empty."}).max(1e3,{message:"Message is too long."}),priority:j(["Low","Medium","High","Urgent"],{required_error:"Please select a priority."}),mood:j(["Happy","Sad","Angry","Neutral","Anxious","Grateful"],{required_error:"Please select your mood."})}),xe=()=>{const S=T(),{user:a,loading:h}=V(),[p,k]=d.useState(null),[H,M]=d.useState(null),[A,P]=d.useState(!0),o=D({resolver:Y(Z),defaultValues:{message_type:"Grievance",content:"",priority:"Medium",mood:"Neutral"}}),G=o.watch("message_type");d.useEffect(()=>{(async()=>{var n;if(h||!a){P(!1);return}const l=(n=a==null?void 0:a.user_metadata)==null?void 0:n.partner_email;if(l)try{const i=await J(l);i?(k(i.id),M(i.username)):(t.error("Partner profile not found for the specified email. Please ensure your partner has registered."),k(null),M(null))}catch{t.error("An unexpected error occurred while fetching partner details.")}else t.error("Your profile does not have a partner email set. Please update your profile.");P(!1)})()},[a,h]);const E=async r=>{if(!a||!p){t.error("Cannot send message: User or partner not identified.");return}const l=a.user_metadata.nickname||a.email;if(!l){t.error("Could not determine your author name. Please ensure you have a nickname set in your profile.");return}try{const{error:n}=await U.from("messages").insert({user_id:a.id,sender_id:a.id,receiver_id:p,author_name:l,subject:r.message_type,content:r.content,message_type:r.message_type,priority:r.priority,mood:r.mood});n?t.error(n.message):(t.success("Message sent successfully!"),S("/dashboard"))}catch{t.error("An unexpected error occurred while sending the message.")}};if(h||A)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-background/80 text-foreground",children:e.jsx("p",{className:"text-xl",children:"Loading..."})});if(!a)return S("/login"),null;const I=a.user_metadata.partner_email||"Not set";if(!p)return e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:[e.jsx("title",{children:"Send Message - Anbae"}),e.jsx("meta",{name:"description",content:"Send a message to your partner. Choose message type, content, priority, and mood."})]}),e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-background to-background/80 p-4 text-center pt-20",children:[e.jsx(C,{className:"w-12 h-12 text-primary mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-4",children:"Partner Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-2",children:"It looks like your partner's profile isn't set up or linked."}),e.jsxs("p",{className:"text-muted-foreground mb-6",children:["Your current partner email is: ",e.jsx("strong",{className:"text-foreground",children:I}),". Please ensure your partner has registered with this exact email, or update it in your profile."]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(f,{to:"/edit-profile",children:e.jsxs(b,{className:"bg-primary hover:bg-primary/90 text-primary-foreground",children:[e.jsx(O,{className:"w-5 h-5 mr-2"})," Edit Partner Email"]})}),e.jsx(f,{to:"/dashboard",children:e.jsx(b,{variant:"outline",className:"text-foreground border-border hover:bg-accent hover:text-accent-foreground",children:"Back to Dashboard"})})]})]})]});const L=r=>{switch(r){case"Grievance":return"bg-destructive/20 dark:bg-destructive/20 border-destructive/50 dark:border-destructive/50";case"Compliment":return"bg-green-100/20 dark:bg-green-950/20 border-green-300/50 dark:border-green-700/50";case"Good Memory":return"bg-yellow-100/20 dark:bg-yellow-950/20 border-yellow-300/50 dark:border-yellow-700/50";case"How I Feel":return"bg-blue-100/20 dark:bg-blue-950/20 border-blue-300/50 dark:border-blue-700/50";default:return"bg-card/60 dark:bg-card/60 border-border/50 dark:border-border/50"}};return e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:[e.jsx("title",{children:"Send Message - Anbae"}),e.jsx("meta",{name:"description",content:"Send a message to your partner. Choose message type, content, priority, and mood."})]}),e.jsx(K,{children:e.jsxs("div",{className:B("w-full max-w-md p-8 rounded-xl shadow-lg backdrop-blur-md transition-colors duration-300",L(G)),children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(C,{className:"w-12 h-12 text-primary mx-auto mb-4"}),e.jsx("h2",{className:"text-3xl font-bold text-foreground mb-2",children:"Send a Message"}),e.jsxs("p",{className:"text-muted-foreground",children:["Share your thoughts with ",H||"your partner","."]})]}),e.jsx(q,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(E),className:"space-y-6",children:[e.jsx(c,{control:o.control,name:"message_type",render:({field:r})=>e.jsxs(m,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-primary"})," Message Type"]}),e.jsxs(y,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(x,{children:e.jsx(N,{className:"bg-input/50 border-border/50 text-foreground",children:e.jsx(v,{placeholder:"Select a message type"})})}),e.jsxs(w,{className:"bg-card border-border text-foreground",children:[e.jsx(s,{value:"Grievance",children:"💔 Grievance"}),e.jsx(s,{value:"Compliment",children:"💖 Compliment"}),e.jsx(s,{value:"Good Memory",children:"✨ Good Memory"}),e.jsx(s,{value:"How I Feel",children:"🤔 How I Feel"})]})]}),e.jsx(g,{})]})}),e.jsx(c,{control:o.control,name:"content",render:({field:r})=>e.jsxs(m,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-primary"})," Explanation"]}),e.jsx(x,{children:e.jsx(z,{placeholder:"Explain the situation, how it makes you feel, and what you need.",...r,rows:5,className:"bg-input/50 border-border/50 text-foreground"})}),e.jsx(g,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(c,{control:o.control,name:"priority",render:({field:r})=>e.jsxs(m,{children:[e.jsx(u,{className:"flex items-center gap-2",children:"Priority"}),e.jsxs(y,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(x,{children:e.jsx(N,{className:"bg-input/50 border-border/50 text-foreground",children:e.jsx(v,{placeholder:"Select priority"})})}),e.jsxs(w,{className:"bg-card border-border text-foreground",children:[e.jsx(s,{value:"Low",children:"Low"}),e.jsx(s,{value:"Medium",children:"Medium"}),e.jsx(s,{value:"High",children:"High"}),e.jsx(s,{value:"Urgent",children:"Urgent"})]})]}),e.jsx(g,{})]})}),e.jsx(c,{control:o.control,name:"mood",render:({field:r})=>e.jsxs(m,{children:[e.jsx(u,{className:"flex items-center gap-2",children:"Your Mood"}),e.jsxs(y,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(x,{children:e.jsx(N,{className:"bg-input/50 border-border/50 text-foreground",children:e.jsx(v,{placeholder:"Select your mood"})})}),e.jsxs(w,{className:"bg-card border-border text-foreground",children:[e.jsx(s,{value:"Happy",children:"😊 Happy"}),e.jsx(s,{value:"Sad",children:"😔 Sad"}),e.jsx(s,{value:"Angry",children:"😠 Angry"}),e.jsx(s,{value:"Neutral",children:"😐 Neutral"}),e.jsx(s,{value:"Anxious",children:"😟 Anxious"}),e.jsx(s,{value:"Grateful",children:"🙏 Grateful"})]})]}),e.jsx(g,{})]})})]}),e.jsxs(b,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"})," Send Message"]})]})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs(f,{to:"/dashboard",className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(X,{className:"inline-block w-4 h-4 mr-1"})," Back to Dashboard"]})})]})})]})};export{xe as default};
