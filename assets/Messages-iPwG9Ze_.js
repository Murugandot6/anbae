import{z as te,r as d,Q as Fe,j as e,F as se,P as M,A as T,y as Ae,E as re,Y as Re,I as Ee,d as R,n as Me,b as Se,s as k,a as P,x as ke,H as Pe,T as Ge,o as Le,B as De,p as Be,L as V,$ as z}from"./main-DjNC3G64.js";import{C as H,a as q,b as Y,c as W}from"./card-DWGr94Ni.js";import{u as ae}from"./index-DPQf-OcN.js";import{a as Q}from"./supabaseHelpers-DuDpU6fp.js";import{A as J,a as X,b as Z}from"./avatar-Drb_kw9a.js";import{B as G,C as Oe}from"./badge-DIDJQpQF.js";import{B as Ke}from"./BackgroundWrapper-B09iK6D5.js";import{A as Ue}from"./arrow-left-CCXN5EYU.js";import{M as $e}from"./mail-D_0Pom4h.js";import{S as Ve}from"./send-DlU7Tlrp.js";import{M as ee}from"./message-square-Bt1ugy7e.js";var B="rovingFocusGroup.onEntryFocus",ze={bubbles:!1,cancelable:!0},S="RovingFocusGroup",[O,oe,He]=Fe(S),[qe,ne]=te(S,[He]),[Ye,We]=qe(S),ie=d.forwardRef((t,r)=>e.jsx(O.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(O.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Qe,{...t,ref:r})})}));ie.displayName=S;var Qe=d.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:n,orientation:o,loop:b=!1,dir:p,currentTabStopId:m,defaultCurrentTabStopId:j,onCurrentTabStopIdChange:y,onEntryFocus:h,preventScrollOnEntryFocus:u=!1,...x}=t,v=d.useRef(null),_=Ae(r,v),I=ae(p),[s,i]=re({prop:m,defaultProp:j??null,onChange:y,caller:S}),[c,f]=d.useState(!1),a=Re(h),l=oe(n),N=d.useRef(!1),[C,F]=d.useState(0);return d.useEffect(()=>{const w=v.current;if(w)return w.addEventListener(B,a),()=>w.removeEventListener(B,a)},[a]),e.jsx(Ye,{scope:n,orientation:o,dir:I,loop:b,currentTabStopId:s,onItemFocus:d.useCallback(w=>i(w),[i]),onItemShiftTab:d.useCallback(()=>f(!0),[]),onFocusableItemAdd:d.useCallback(()=>F(w=>w+1),[]),onFocusableItemRemove:d.useCallback(()=>F(w=>w-1),[]),children:e.jsx(M.div,{tabIndex:c||C===0?-1:0,"data-orientation":o,...x,ref:_,style:{outline:"none",...t.style},onMouseDown:T(t.onMouseDown,()=>{N.current=!0}),onFocus:T(t.onFocus,w=>{const D=!N.current;if(w.target===w.currentTarget&&D&&!c){const g=new CustomEvent(B,ze);if(w.currentTarget.dispatchEvent(g),!g.defaultPrevented){const E=l().filter(A=>A.focusable),Ce=E.find(A=>A.active),_e=E.find(A=>A.id===s),Ie=[Ce,_e,...E].filter(Boolean).map(A=>A.ref.current);de(Ie,u)}}N.current=!1}),onBlur:T(t.onBlur,()=>f(!1))})})}),ce="RovingFocusGroupItem",le=d.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:n,focusable:o=!0,active:b=!1,tabStopId:p,children:m,...j}=t,y=se(),h=p||y,u=We(ce,n),x=u.currentTabStopId===h,v=oe(n),{onFocusableItemAdd:_,onFocusableItemRemove:I,currentTabStopId:s}=u;return d.useEffect(()=>{if(o)return _(),()=>I()},[o,_,I]),e.jsx(O.ItemSlot,{scope:n,id:h,focusable:o,active:b,children:e.jsx(M.span,{tabIndex:x?0:-1,"data-orientation":u.orientation,...j,ref:r,onMouseDown:T(t.onMouseDown,i=>{o?u.onItemFocus(h):i.preventDefault()}),onFocus:T(t.onFocus,()=>u.onItemFocus(h)),onKeyDown:T(t.onKeyDown,i=>{if(i.key==="Tab"&&i.shiftKey){u.onItemShiftTab();return}if(i.target!==i.currentTarget)return;const c=Ze(i,u.orientation,u.dir);if(c!==void 0){if(i.metaKey||i.ctrlKey||i.altKey||i.shiftKey)return;i.preventDefault();let a=v().filter(l=>l.focusable).map(l=>l.ref.current);if(c==="last")a.reverse();else if(c==="prev"||c==="next"){c==="prev"&&a.reverse();const l=a.indexOf(i.currentTarget);a=u.loop?et(a,l+1):a.slice(l+1)}setTimeout(()=>de(a))}}),children:typeof m=="function"?m({isCurrentTabStop:x,hasTabStop:s!=null}):m})})});le.displayName=ce;var Je={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Xe(t,r){return r!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function Ze(t,r,n){const o=Xe(t.key,n);if(!(r==="vertical"&&["ArrowLeft","ArrowRight"].includes(o))&&!(r==="horizontal"&&["ArrowUp","ArrowDown"].includes(o)))return Je[o]}function de(t,r=!1){const n=document.activeElement;for(const o of t)if(o===n||(o.focus({preventScroll:r}),document.activeElement!==n))return}function et(t,r){return t.map((n,o)=>t[(r+o)%t.length])}var tt=ie,st=le,L="Tabs",[rt,vt]=te(L,[ne]),ue=ne(),[at,$]=rt(L),me=d.forwardRef((t,r)=>{const{__scopeTabs:n,value:o,onValueChange:b,defaultValue:p,orientation:m="horizontal",dir:j,activationMode:y="automatic",...h}=t,u=ae(j),[x,v]=re({prop:o,onChange:b,defaultProp:p??"",caller:L});return e.jsx(at,{scope:n,baseId:se(),value:x,onValueChange:v,orientation:m,dir:u,activationMode:y,children:e.jsx(M.div,{dir:u,"data-orientation":m,...h,ref:r})})});me.displayName=L;var fe="TabsList",xe=d.forwardRef((t,r)=>{const{__scopeTabs:n,loop:o=!0,...b}=t,p=$(fe,n),m=ue(n);return e.jsx(tt,{asChild:!0,...m,orientation:p.orientation,dir:p.dir,loop:o,children:e.jsx(M.div,{role:"tablist","aria-orientation":p.orientation,...b,ref:r})})});xe.displayName=fe;var be="TabsTrigger",pe=d.forwardRef((t,r)=>{const{__scopeTabs:n,value:o,disabled:b=!1,...p}=t,m=$(be,n),j=ue(n),y=ve(m.baseId,o),h=we(m.baseId,o),u=o===m.value;return e.jsx(st,{asChild:!0,...j,focusable:!b,active:u,children:e.jsx(M.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":h,"data-state":u?"active":"inactive","data-disabled":b?"":void 0,disabled:b,id:y,...p,ref:r,onMouseDown:T(t.onMouseDown,x=>{!b&&x.button===0&&x.ctrlKey===!1?m.onValueChange(o):x.preventDefault()}),onKeyDown:T(t.onKeyDown,x=>{[" ","Enter"].includes(x.key)&&m.onValueChange(o)}),onFocus:T(t.onFocus,()=>{const x=m.activationMode!=="manual";!u&&!b&&x&&m.onValueChange(o)})})})});pe.displayName=be;var ge="TabsContent",he=d.forwardRef((t,r)=>{const{__scopeTabs:n,value:o,forceMount:b,children:p,...m}=t,j=$(ge,n),y=ve(j.baseId,o),h=we(j.baseId,o),u=o===j.value,x=d.useRef(u);return d.useEffect(()=>{const v=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(v)},[]),e.jsx(Ee,{present:b||u,children:({present:v})=>e.jsx(M.div,{"data-state":u?"active":"inactive","data-orientation":j.orientation,role:"tabpanel","aria-labelledby":y,hidden:!v,id:h,tabIndex:0,...m,ref:r,style:{...t.style,animationDuration:x.current?"0s":void 0},children:v&&p})})});he.displayName=ge;function ve(t,r){return`${t}-trigger-${r}`}function we(t,r){return`${t}-content-${r}`}var ot=me,je=xe,ye=pe,Ne=he;const nt=ot,Te=d.forwardRef(({className:t,...r},n)=>e.jsx(je,{ref:n,className:R("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...r}));Te.displayName=je.displayName;const K=d.forwardRef(({className:t,...r},n)=>e.jsx(ye,{ref:n,className:R("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...r}));K.displayName=ye.displayName;const U=d.forwardRef(({className:t,...r},n)=>e.jsx(Ne,{ref:n,className:R("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...r}));U.displayName=Ne.displayName;const wt=()=>{const{user:t,loading:r}=Me(),n=Se(),[o,b]=d.useState([]),[p,m]=d.useState([]),[j,y]=d.useState(!0),[h,u]=d.useState(new Map),x=async s=>{if(h.has(s))return h.get(s);const i=await Q(s);return i&&u(c=>new Map(c).set(s,i)),i};if(d.useEffect(()=>{!r&&t?(async()=>{if(!t){y(!1);return}y(!0);try{const{data:c,error:f}=await k.from("messages").select("*").eq("sender_id",t.id).is("parent_message_id",null).order("created_at",{ascending:!1});f&&P.error("Failed to load sent messages: "+f.message);const{data:a,error:l}=await k.from("messages").select("*").eq("receiver_id",t.id).is("parent_message_id",null).order("created_at",{ascending:!1});l&&P.error("Failed to load received messages: "+l.message);const N=new Set;c==null||c.forEach(g=>N.add(g.receiver_id)),a==null||a.forEach(g=>N.add(g.sender_id)),N.add(t.id);const C=[];for(const g of Array.from(N)){const E=await Q(g);E&&C.push(E)}const F=new Map;C.forEach(g=>{F.set(g.id,g)}),u(F);const w=(c==null?void 0:c.map(g=>({...g,receiverProfile:F.get(g.receiver_id)||null})))||[],D=(a==null?void 0:a.map(g=>({...g,senderProfile:F.get(g.sender_id)||null})))||[];b(w),m(D)}catch{P.error("An unexpected error occurred while loading messages.")}finally{y(!1)}})():!r&&!t&&n("/login");const i=k.channel("messages_channel").on("postgres_changes",{event:"*",schema:"public",table:"messages",filter:`sender_id=eq.${t==null?void 0:t.id}.or.receiver_id=eq.${t==null?void 0:t.id}`},async c=>{const f=c.new;if(f.parent_message_id===null)if(c.eventType==="INSERT"){const a=await x(f.sender_id),l=await x(f.receiver_id),N={...f,senderProfile:a,receiverProfile:l};f.receiver_id===(t==null?void 0:t.id)?(m(C=>[N,...C]),P.info(`New message from ${(a==null?void 0:a.username)||(a==null?void 0:a.email)||"Your Partner"}!`)):f.sender_id===(t==null?void 0:t.id)&&b(C=>[N,...C])}else c.eventType==="UPDATE"&&(m(a=>a.map(l=>l.id===f.id?{...l,...f}:l)),b(a=>a.map(l=>l.id===f.id?{...l,...f}:l)))}).subscribe();return()=>{k.removeChannel(i)}},[t,r,n]),r||j)return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-background to-background/80 text-foreground",children:[e.jsx(ke,{}),e.jsx("p",{className:"text-xl mt-4",children:"Loading messages..."})]});if(!t)return n("/login"),null;const v=s=>{switch(s){case"Grievance":return"bg-destructive/20 dark:bg-destructive/20 border-destructive/50 dark:border-destructive/50";case"Compliment":return"bg-green-100/20 dark:bg-green-950/20 border-green-300/50 dark:border-green-700/50";case"Good Memory":return"bg-yellow-100/20 dark:bg-yellow-950/20 border-yellow-300/50 dark:border-yellow-700/50";case"How I Feel":return"bg-blue-100/20 dark:bg-blue-950/20 border-blue-300/50 dark:border-blue-700/50";default:return"bg-card/20 dark:bg-card/20 border-border/50 dark:border-border/50"}},_=s=>{switch(s){case"Grievance":return"ðŸ’”";case"Compliment":return"ðŸ’–";case"Good Memory":return"âœ¨";case"How I Feel":return"ðŸ¤”";default:return""}},I=s=>v(s);return e.jsxs(e.Fragment,{children:[e.jsxs(Pe,{children:[e.jsx("title",{children:"Messages - Anbae"}),e.jsx("meta",{name:"description",content:"View your sent and received messages with your partner on Anbae. Keep track of your conversations."})]}),e.jsx(Ke,{className:"pt-0 md:pt-0",children:e.jsxs("div",{className:"w-full max-w-2xl mx-auto pt-8 mt-16 md:mt-8 px-4",children:[" ",e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsxs(Ge,{children:[e.jsx(Le,{asChild:!0,children:e.jsx(De,{variant:"outline",size:"icon",className:"w-9 h-9 sm:w-10 sm:h-10 text-foreground border-border hover:bg-accent hover:text-accent-foreground rounded-full shadow-md",onClick:()=>{n("/dashboard",{replace:!0})},children:e.jsx(Ue,{className:"w-4 h-4 sm:w-5 sm:h-5"})})}),e.jsx(Be,{children:"Back to Dashboard"})]})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mx-auto",children:"Your Messages"})]}),e.jsxs(nt,{defaultValue:"inbox",className:"w-full",children:[e.jsxs(Te,{className:"grid w-full grid-cols-2 mb-4 sm:mb-6 bg-card/60 backdrop-blur-md border border-border/50 rounded-xl h-10 sm:h-12",children:[" ",e.jsxs(K,{value:"inbox",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-md rounded-lg transition-all duration-200 text-sm sm:text-base",children:[e.jsx($e,{className:"w-4 h-4 mr-1 sm:mr-2"})," Inbox (",p.length,")"]}),e.jsxs(K,{value:"outbox",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-md rounded-lg transition-all duration-200 text-sm sm:text-base",children:[e.jsx(Ve,{className:"w-4 h-4 mr-1 sm:mr-2"})," Outbox (",o.length,")"]})]}),e.jsx(U,{value:"inbox",children:e.jsxs(H,{className:"bg-card/60 dark:bg-card/60 shadow-lg backdrop-blur-md border border-border/50 rounded-xl",children:[e.jsxs(q,{className:"p-3 sm:p-4",children:[" ",e.jsx(Y,{className:"text-foreground text-lg sm:text-xl",children:"Received Messages"})]}),e.jsxs(W,{className:"text-muted-foreground p-3 sm:p-4 pt-0",children:[" ",p.length>0?e.jsx("ul",{className:"space-y-3 sm:space-y-4",children:p.map(s=>{var i,c,f,a,l;return e.jsx("li",{className:R("relative border-b border-border/30 pb-2 last:border-b-0 max-w-full mx-auto p-2 rounded-xl transition-all duration-300 hover:scale-[1.01] hover:shadow-md",v(s.message_type)),children:e.jsxs(V,{to:`/messages/${s.id}`,className:"block hover:bg-opacity-80 rounded-md transition-colors flex items-center gap-2 sm:gap-3",children:[e.jsx("span",{className:R("absolute -top-3 -left-3 text-xl sm:text-2xl z-10 w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center rounded-full shadow-md",I(s.message_type)),children:_(s.message_type)}),e.jsxs(J,{className:"w-10 h-10 sm:w-12 sm:h-12 ml-6 sm:ml-8 border-2 border-primary",children:[e.jsx(X,{src:((i=s.senderProfile)==null?void 0:i.avatar_url)||"",alt:"Sender Avatar"}),e.jsx(Z,{className:"bg-primary text-primary-foreground text-sm sm:text-base",children:((f=(c=s.senderProfile)==null?void 0:c.username)==null?void 0:f.charAt(0).toUpperCase())||((l=(a=s.senderProfile)==null?void 0:a.email)==null?void 0:l.charAt(0).toUpperCase())})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-base sm:text-lg text-foreground mb-0.5 sm:mb-1 flex items-center justify-between gap-1 sm:gap-2",children:[e.jsxs("span",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(ee,{className:"w-4 h-4 sm:w-5 sm:h-5 text-primary"}),s.subject]}),e.jsxs("span",{className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-sm text-muted-foreground flex-shrink-0",children:[s.is_read?null:e.jsx(G,{className:"bg-accent text-accent-foreground text-xs font-bold px-2 py-0.5",children:"NEW!"}),s.status==="closed"&&e.jsx(G,{variant:"secondary",className:"bg-muted text-muted-foreground text-xs px-2 py-0.5",children:"Closed"})]})]}),e.jsx("p",{className:"text-xs sm:text-sm text-foreground line-clamp-2",children:s.content}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5 sm:mt-1",children:z(s.created_at)})]})]})},s.id)})}):e.jsx("p",{className:"text-sm sm:text-base",children:"No messages received yet."})]})]})}),e.jsx(U,{value:"outbox",children:e.jsxs(H,{className:"bg-card/60 dark:bg-card/60 shadow-lg backdrop-blur-md border border-border/50 rounded-xl",children:[e.jsxs(q,{className:"p-3 sm:p-4",children:[" ",e.jsx(Y,{className:"text-foreground text-lg sm:text-xl",children:"Sent Messages"})]}),e.jsxs(W,{className:"text-muted-foreground p-3 sm:p-4 pt-0",children:[" ",o.length>0?e.jsx("ul",{className:"space-y-3 sm:space-y-4",children:o.map(s=>{var i,c,f,a,l;return e.jsx("li",{className:R("relative border-b border-border/30 pb-2 last:border-b-0 max-w-full mx-auto p-2 rounded-xl transition-all duration-300 hover:scale-[1.01] hover:shadow-md",v(s.message_type)),children:e.jsxs(V,{to:`/messages/${s.id}`,className:"block hover:bg-opacity-80 rounded-md transition-colors flex items-center gap-2 sm:gap-3",children:[e.jsx("span",{className:R("absolute -top-3 -left-3 text-xl sm:text-2xl z-10 w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center rounded-full shadow-md",I(s.message_type)),children:_(s.message_type)}),e.jsxs(J,{className:"w-10 h-10 sm:w-12 sm:h-12 ml-6 sm:ml-8 border-2 border-primary",children:[e.jsx(X,{src:((i=s.receiverProfile)==null?void 0:i.avatar_url)||"",alt:"Receiver Avatar"}),e.jsx(Z,{className:"bg-primary text-primary-foreground text-sm sm:text-base",children:((f=(c=s.receiverProfile)==null?void 0:c.username)==null?void 0:f.charAt(0).toUpperCase())||((l=(a=s.receiverProfile)==null?void 0:a.email)==null?void 0:l.charAt(0).toUpperCase())})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-base sm:text-lg text-foreground mb-0.5 sm:mb-1 flex items-center justify-between gap-1 sm:gap-2",children:[e.jsxs("span",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(ee,{className:"w-4 h-4 sm:w-5 sm:h-5 text-primary"}),s.subject]}),e.jsxs("span",{className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-sm text-muted-foreground flex-shrink-0",children:[s.read_at&&e.jsxs(G,{className:"bg-accent text-accent-foreground text-xs font-bold px-2 py-0.5 flex items-center gap-1",children:[e.jsx(Oe,{className:"w-3 h-3"})," Read"]}),s.status==="closed"&&e.jsx(G,{variant:"secondary",className:"bg-muted text-muted-foreground text-xs px-2 py-0.5",children:"Closed"})]})]}),e.jsx("p",{className:"text-xs sm:text-sm text-foreground line-clamp-2",children:s.content}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5 sm:mt-1",children:z(s.created_at)})]})]})},s.id)})}):e.jsx("p",{className:"text-sm sm:text-base",children:"No messages sent yet."})]})]})})]})]})})]})};export{wt as default};
