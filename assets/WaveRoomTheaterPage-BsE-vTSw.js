import{j as e,r as c,a2 as O,a3 as D,a4 as H,a5 as ne,W as oe,b as ae,l as ie,a1 as le,a as L,H as ce,B as E}from"./main-BHPIGV8h.js";import{A as de}from"./arrow-left-C4HDbgt0.js";import{C as ue}from"./copy-EXirslhl.js";import{L as me}from"./log-out-zivWoyqF.js";const ge=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})}),G=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"})}),he=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.25 9.75 19.5 12m0 0 2.25 2.25M19.5 12l2.25-2.25M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"})}),B=["https://de1.api.radio-browser.info","https://nl1.api.radio-browser.info","https://at1.api.radio-browser.info"];let y=[],I=null,R=0;const fe=async()=>{try{const t=await fetch("https://all.api.radio-browser.info/json/servers");if(!t.ok)throw new Error(`Failed to fetch server list: ${t.statusText}`);const r=(await t.json()).filter(o=>o.lastcheckok===1).sort((o,i)=>i.votes-o.votes).map(o=>`https://${o.name}`);r.length>0?y=r:y=[...B]}catch{y=[...B]}},xe=()=>(I||(I=fe()),I),S=async t=>{await xe();const s=y.length;if(s===0)throw new Error("No API servers available to fetch from.");let r=null;for(let o=0;o<s;o++){const a=`${y[R]}/json/${t}`;try{const n=await fetch(a,{signal:AbortSignal.timeout(8e3)});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const l=await n.json();if(Array.isArray(l)&&l.length===0)return l;if(!Array.isArray(l))throw new Error("Invalid response from mirror");return l}catch(n){r=n instanceof Error?n:new Error(String(n)),R=(R+1)%y.length}}throw new Error(`All API mirrors failed. Last error: ${r==null?void 0:r.message}`)},pe=async()=>(await S("languages?hidebroken=true&order=stationcount&reverse=true")).map(s=>s.name).filter(s=>s.trim()!==""),be=async()=>(await S("countries?hidebroken=true&order=stationcount&reverse=true")).map(s=>s.name).filter(s=>s.trim()!==""),ve=async(t=150)=>(await S(`tags?hidebroken=true&order=stationcount&reverse=true&limit=${t}`)).map(r=>r.name).filter(r=>r.trim()!==""),q=t=>{const s=["MP3","AAC","OGG","FLAC","OPUS","WMA","WAV"];return t.filter(r=>{var i;if(r.hls===1)return!0;const o=((i=r.codec)==null?void 0:i.toUpperCase())||"";return o===""?!0:s.some(a=>o.includes(a))})},je=async(t=100)=>{const s=await S(`stations/topclick/${t}?hidebroken=true`);return q(s)},we=async(t,s=100)=>{const r=new URLSearchParams({limit:String(s),hidebroken:"true",order:"clickcount",reverse:"true"});t.name&&r.set("name",t.name),t.language&&r.set("language",t.language),t.country&&r.set("country",t.country),t.tag&&r.set("tag",t.tag);const o=await S(`stations/search?${r.toString()}`);return q(o)},ye=({onSearch:t,onClear:s,isLoading:r,initialQuery:o,className:i})=>{const[a,n]=c.useState(o),l=d=>{d.preventDefault(),t(a.trim())},g=()=>{n(""),s()};return e.jsxs("form",{onSubmit:l,className:`relative w-full ${i||""}`,children:[" ",e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(ge,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("input",{type:"search",value:a,onChange:d=>n(d.target.value),className:"block w-full rounded-md border-0 bg-input/50 py-2.5 pl-10 pr-10 text-foreground shadow-sm ring-1 ring-inset ring-border/50 placeholder:text-muted-foreground focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6 transition-all",placeholder:"Search for a station...",disabled:r}),a&&e.jsx("button",{type:"button",onClick:g,className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx(O,{className:"h-5 w-5 text-muted-foreground hover:text-foreground"})})]})},Ne=({station:t,isPlaying:s,onSelect:r})=>{var g;const o=()=>e.jsx(H,{className:"w-10 h-10 md:w-12 md:h-12 text-muted-foreground"}),i=d=>{var x;const h=d.currentTarget;h.style.display="none";const f=(x=h.parentElement)==null?void 0:x.querySelector(".fallback-icon");f&&f.classList.remove("hidden")},a=d=>d?d.charAt(0).toUpperCase()+d.slice(1):"",n=(g=t.language)==null?void 0:g.split(",")[0].trim(),l=t.country||"Global";return e.jsxs("div",{onClick:r,className:`group relative flex flex-col p-2 sm:p-3 md:p-4 text-center bg-card/60 backdrop-blur-md rounded-2xl shadow-lg cursor-pointer transition-all duration-300 ease-in-out transform hover:-translate-y-1 hover:shadow-primary/30 ${s?"ring-2 ring-offset-2 ring-offset-background ring-primary":"ring-1 ring-border/50"} items-center`,children:[s&&e.jsxs("div",{className:"absolute top-2 right-2 sm:top-3 sm:right-3 bg-primary text-primary-foreground text-xs font-bold px-2 py-1 rounded-full flex items-center gap-1.5 shadow-lg z-10",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-foreground rounded-full animate-pulse"}),e.jsx("span",{children:"On Air"})]}),e.jsxs("div",{className:"relative w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 mb-3 sm:mb-4",children:[e.jsxs("div",{className:"relative w-full h-full rounded-full bg-input/50 flex items-center justify-center overflow-hidden ring-4 ring-border/50 group-hover:ring-primary/50 transition-all duration-300",children:[e.jsx("img",{src:t.favicon,alt:`${t.name} logo`,className:"w-full h-full object-cover",onError:i}),e.jsx("div",{className:"fallback-icon hidden absolute inset-0 w-full h-full flex items-center justify-center",children:e.jsx(o,{})})]}),e.jsx("div",{className:"absolute inset-0 bg-black/60 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:s?e.jsx(G,{className:"w-8 h-8 md:w-10 md:h-10 text-primary-foreground/90"}):e.jsx(D,{className:"w-8 h-8 md:w-10 md:h-10 text-primary-foreground/90"})})]}),e.jsxs("div",{className:"w-full px-1",children:[e.jsx("h3",{className:"font-bold text-sm md:text-base text-foreground leading-tight truncate",title:t.name,children:t.name}),e.jsxs("div",{className:"mt-1 space-y-0.5",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground truncate",title:l,children:l}),n&&e.jsx("p",{className:"text-xs text-muted-foreground/80 truncate",title:a(n),children:a(n)})]})]})]})},Se=()=>e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:Array.from({length:15}).map((t,s)=>e.jsxs("div",{className:"flex flex-col p-2 sm:p-3 md:p-4 bg-card/60 backdrop-blur-md rounded-2xl animate-pulse aspect-square items-center justify-center shadow-lg",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 rounded-full bg-muted/50 mb-3 sm:mb-4"}),e.jsx("div",{className:"h-3 md:h-4 bg-muted/50 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-2 md:h-3 bg-muted/50 rounded w-1/2"})]},s))}),ke=({stations:t,onSelectStation:s,currentStation:r,isLoading:o,error:i})=>o?e.jsx(Se,{}):i?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center text-muted-foreground",children:[e.jsx("h3",{className:"text-xl font-semibold text-destructive",children:"Oops! Something went wrong."}),e.jsx("p",{children:i})]}):t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center text-muted-foreground",children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:"No Stations Found"}),e.jsx("p",{children:"Try a different search term or check back later."})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:t.map(a=>e.jsx(Ne,{station:a,isPlaying:(r==null?void 0:r.stationuuid)===a.stationuuid,onSelect:()=>s(a)},a.stationuuid))}),Ce=({station:t,isPlaying:s,onSetPlaying:r,onClear:o,onShowStation:i})=>{var v;const[a,n]=c.useState(!1),l=()=>{r()},g=()=>{o()},d=()=>{n(m=>!m)},h=m=>m?m.charAt(0).toUpperCase()+m.slice(1):"",f=(v=t.language)==null?void 0:v.split(",")[0].trim(),x=t.country||"Global";return e.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-50",children:e.jsx("div",{className:"bg-card/80 backdrop-blur-lg border-t border-border/50 shadow-2xl p-3",children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between gap-4",children:[e.jsxs("button",{onClick:()=>i(t),className:"flex items-center gap-4 flex-1 min-w-0 text-left rounded-md hover:bg-accent/20 p-2 -m-2 transition-colors",title:"Find this station in the list",children:[e.jsx("img",{src:t.favicon,alt:t.name,className:"w-14 h-14 rounded-md shadow-md bg-input/50",onError:m=>{const k=m.currentTarget;k.style.display="none";const N=k.nextElementSibling;N&&N.classList.remove("hidden")}}),e.jsx("div",{className:"hidden w-14 h-14 rounded-md shadow-md bg-input/50 flex items-center justify-center",children:e.jsx(H,{className:"w-8 h-8 text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground truncate",title:t.name,children:t.name}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",title:x,children:x}),f&&e.jsx("p",{className:"text-xs text-muted-foreground/80 truncate",title:h(f),children:h(f)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:d,title:a?"Unmute":"Mute",className:"bg-input/50 hover:bg-accent/20 rounded-full p-3 text-foreground transition-colors focus:outline-none focus:ring-2 focus:ring-border/50",children:a?e.jsx(he,{className:"w-6 h-6"}):e.jsx(G,{className:"w-6 h-6"})}),e.jsx("button",{onClick:l,title:s?"Pause":"Play",className:"bg-primary hover:bg-primary/90 rounded-full p-3 text-primary-foreground transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-background",children:s?e.jsx(ne,{className:"w-6 h-6"}):e.jsx(D,{className:"w-6 h-6"})}),e.jsx("button",{onClick:g,title:"Stop and clear player",className:"bg-input/50 hover:bg-accent/20 rounded-full p-2 text-muted-foreground hover:text-foreground transition-colors focus:outline-none focus:ring-2 focus:ring-border/50",children:e.jsx(O,{className:"w-5 h-5"})})]})]})})})},T=({label:t,id:s,options:r,value:o,onChange:i,disabled:a})=>e.jsxs("div",{className:"flex-1 min-w-[140px]",children:[e.jsx("label",{htmlFor:s,className:"sr-only",children:t}),e.jsxs("select",{id:s,name:s,value:o,onChange:n=>i(s,n.target.value),disabled:a||r.length===0,className:"block w-full rounded-md border-0 bg-input/50 py-2 pl-3 pr-8 text-foreground shadow-sm ring-1 ring-inset ring-border/50 placeholder:text-muted-foreground focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsxs("option",{value:"",children:["All ",t,"s"]}),r.map(n=>e.jsx("option",{value:n,children:n.charAt(0).toUpperCase()+n.slice(1)},n))]})]}),Ae=({languages:t,countries:s,tags:r,selectedLanguage:o,selectedCountry:i,selectedTag:a,onFilterChange:n,isLoading:l})=>e.jsxs("div",{className:"flex flex-wrap w-full md:w-auto items-center gap-2 md:gap-3",children:[e.jsx(T,{label:"Language",id:"language",options:t,value:o,onChange:n,disabled:l}),e.jsx(T,{label:"Country",id:"country",options:s,value:i,onChange:n,disabled:l}),e.jsx(T,{label:"Category",id:"tag",options:r,value:a,onChange:n,disabled:l})]}),Te=()=>{const{roomCode:t}=oe(),s=ae(),{user:r,loading:o}=ie(),{currentStation:i,isPlaying:a,roomCode:n,setRoom:l,setStation:g,togglePlay:d,clearStation:h}=le(),[f,x]=c.useState([]),[v,m]=c.useState(!0),[k,N]=c.useState(null),[j,P]=c.useState(""),[C,$]=c.useState(""),[A,F]=c.useState(""),[b,U]=c.useState(""),[Q,Z]=c.useState([]),[_,V]=c.useState([]),[Y,X]=c.useState([]),[Le,W]=c.useState(!1);c.useEffect(()=>{t&&l(t)},[t,l]),c.useEffect(()=>{(async()=>{try{const[p,z,w]=await Promise.all([pe(),be(),ve(150)]);Z(p),V(z),X(w)}catch(p){console.error("Failed to load filter options",p)}})()},[]),c.useEffect(()=>{const u=setTimeout(()=>{m(!0),N(null),(j||C||A||b?we({name:j,language:C,country:A,tag:b}):je(100)).then(w=>{x(w)}).catch(w=>{N(w instanceof Error?w.message:"An unknown error occurred."),x([])}).finally(()=>{m(!1)})},200);return()=>clearTimeout(u)},[j,C,A,b]);const J=u=>{u.url_resolved?g(u):L.error(`Station ${u.name} does not have a valid stream URL.`)},K=()=>{t&&(navigator.clipboard.writeText(t),W(!0),L.success("Room code copied!"),setTimeout(()=>W(!1),2e3))},ee=u=>{P(u.name),$(""),F(""),U("")},te=()=>{s("/dashboard")},se=()=>{h(),l(null),s("/dashboard"),L.info("You have left the Wave Room.")},re=()=>j?`Results for "${j}"`:b?`${b.charAt(0).toUpperCase()+b.slice(1)} Stations`:"Popular Stations";if(o)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center text-foreground",children:e.jsx("p",{className:"text-xl",children:"Loading Session..."})});if(!r)return L.error("You must be logged in to enter a Wave Room."),s("/login"),null;if(!t)return s("/waveroom"),null;const M=n===t;return e.jsxs(e.Fragment,{children:[e.jsxs(ce,{children:[e.jsx("title",{children:`Wave Room ${t} - Anbae`}),e.jsx("meta",{name:"description",content:`Listen to internet radio with your partner in Wave Room ${t}.`})]}),e.jsxs("div",{className:"h-screen w-screen bg-background text-foreground flex flex-col antialiased",children:[e.jsx("header",{className:"bg-transparent backdrop-blur-md p-4 z-20 sticky top-0",children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(E,{onClick:te,variant:"outline",size:"icon",className:"w-10 h-10 text-foreground border-border hover:bg-accent hover:text-accent-foreground rounded-full shadow-md","aria-label":"Back to Dashboard",children:e.jsx(de,{className:"w-5 h-5"})})}),e.jsx("h1",{className:"text-3xl font-bold text-foreground mx-auto",children:"Wave Room"}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-input/50 rounded-md p-2 border border-border/50",children:[e.jsx("span",{className:"text-sm text-muted-foreground hidden md:inline",children:"CODE:"}),e.jsx("span",{className:"font-bold tracking-widest text-foreground",children:t}),e.jsx(E,{onClick:K,variant:"ghost",size:"icon",className:"w-7 h-7 text-muted-foreground hover:text-foreground hover:bg-accent/20",children:e.jsx(ue,{className:"w-4 h-4"})})]}),e.jsx(E,{onClick:se,variant:"destructive",size:"icon",className:"w-10 h-10 bg-destructive hover:bg-destructive/90 text-destructive-foreground rounded-full shadow-md",children:e.jsx(me,{className:"w-5 h-5"})})]})]})}),e.jsx("main",{className:"flex-grow overflow-y-auto pb-32",children:e.jsxs("div",{className:"container mx-auto p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground flex-shrink-0 order-1 md:order-none",children:re()}),e.jsx(Ae,{languages:Q,countries:_,tags:Y,selectedLanguage:C,selectedCountry:A,selectedTag:b,onFilterChange:(u,p)=>{u==="language"&&$(p),u==="country"&&F(p),u==="tag"&&U(p)},isLoading:v})]}),e.jsx(ye,{onSearch:P,isLoading:v,initialQuery:j,onClear:()=>P(""),className:"mb-8"}),e.jsx(ke,{stations:f,onSelectStation:J,currentStation:M?i:null,isLoading:v,error:k})]})}),M&&i&&e.jsx(Ce,{station:i,isPlaying:a,onSetPlaying:d,onClear:h,onShowStation:ee})]})]})};export{Te as default};
