import{r as t,j as e,d as I,a0 as E,H as R,L as w,B as h,a2 as T,a3 as D,s as A,x as M,a as V}from"./main-DjNC3G64.js";import{R as _}from"./index-D-i1h5OH.js";import{A as B}from"./arrow-left-CCXN5EYU.js";import{C as F}from"./check-J0izW_e_.js";import{C as H,V as q,a as K}from"./volume-x-yvsOi_IS.js";import"./index-Chjiymov.js";const O=({lyrics:s,currentTime:n})=>{const[c,i]=t.useState(null),[o,a]=t.useState(""),l=t.useMemo(()=>{if(!s||s.length===0)return-1;let r=s.length-1;for(;r>=0;){if(s[r].time<=n)return r;r--}return-1},[s,n]);return t.useEffect(()=>{const r=l!==-1?s[l].text:null;if(r!==c){a("animate-fade-out");const d=setTimeout(()=>{i(r),a("animate-fade-in")},500);return()=>clearTimeout(d)}},[l,s,c]),s.length?e.jsx("div",{className:"flex items-center justify-center h-full text-center p-4",children:e.jsx("p",{className:I("text-3xl sm:text-4xl md:text-6xl font-bold text-foreground drop-shadow-lg",o),children:c||"â™ª"})}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground text-xl sm:text-2xl",children:e.jsx("p",{children:"Waiting for the song to start..."})})},W=s=>{if(!s)return[];const n=s.split(`
`),c=[],i=/\[(\d{2}):(\d{2})\.(\d{2,3})\]/;for(const o of n){const a=o.match(i);if(a){const l=parseInt(a[1],10),r=parseInt(a[2],10),d=parseInt(a[3].padEnd(3,"0"),10),u=l*60+r+d/1e3,f=o.replace(i,"").trim();f&&c.push({time:u,text:f})}}return c.sort((o,a)=>o.time-a.time)},X=()=>e.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center text-foreground",children:[e.jsx(M,{}),e.jsx("p",{className:"mt-4 text-base sm:text-xl",children:"Loading Your Special Message..."})]}),b=({message:s})=>e.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center text-foreground text-center p-4",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-destructive mb-3 sm:mb-4",children:"Oops!"}),e.jsx("p",{className:"text-sm sm:text-base",children:s}),e.jsx(w,{to:"/dashboard",children:e.jsx(h,{variant:"outline",className:"mt-4 text-foreground border-border hover:bg-accent hover:text-accent-foreground text-sm sm:text-base px-4 py-2 sm:px-6 sm:py-3",children:"Back to Dashboard"})})]}),$=()=>{const{id:s}=E(),[n,c]=t.useState(null),[i,o]=t.useState(!0),[a,l]=t.useState(null),[r,d]=t.useState(!1),[u,f]=t.useState(!0),[p,v]=t.useState(0),[y,N]=t.useState(0),[L,g]=t.useState(!1),j=t.useRef(null);t.useEffect(()=>{if(!s){l("No promposal ID provided."),o(!1);return}(async()=>{const{data:x,error:z}=await A.from("proposals").select("id, video_url, lrc_content").eq("id",s).single();z||!x?(l("Could not find this promposal. The link may be incorrect or it may have been deleted."),o(!1)):(c(x),o(!1))})()},[s]);const S=t.useMemo(()=>n?W(n.lrc_content):[],[n]),k=m=>{v(m.playedSeconds)},C=m=>{N(m)},P=()=>{navigator.clipboard.writeText(window.location.href),g(!0),V.success("Link copied to clipboard!"),setTimeout(()=>g(!1),2e3)};return i?e.jsx(X,{}):a?e.jsx(b,{message:a}):n?e.jsxs(e.Fragment,{children:[e.jsxs(R,{children:[e.jsx("title",{children:"Promposal - Anbae"}),e.jsx("meta",{name:"description",content:"View a special video promposal with synchronized lyrics created on Anbae."})]}),e.jsxs("div",{className:"fixed inset-0 bg-background z-50 flex flex-col items-center justify-center p-4 md:p-8 text-foreground overflow-hidden",children:[e.jsx("div",{style:{display:"none"},children:e.jsx(_,{ref:j,url:n.video_url,playing:r,muted:u,onProgress:k,onDuration:C,progressInterval:100})}),e.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2 z-20",children:e.jsx(w,{to:"/dashboard",children:e.jsx(h,{variant:"outline",size:"icon",className:"w-9 h-9 sm:w-10 sm:h-10 text-foreground border-border hover:bg-accent hover:text-accent-foreground rounded-full shadow-md",children:e.jsx(B,{className:"w-4 h-4 sm:w-5 sm:h-5"})})})}),e.jsx("div",{className:"absolute top-3 right-3 flex items-center gap-2 z-20",children:e.jsx(h,{onClick:P,variant:"ghost",size:"icon",className:"w-9 h-9 sm:w-10 sm:h-10 text-foreground hover:bg-accent hover:text-accent-foreground",children:L?e.jsx(F,{className:"w-4 h-4 sm:w-5 sm:h-5 text-primary"}):e.jsx(H,{className:"w-4 h-4 sm:w-5 sm:h-5"})})}),e.jsx("div",{className:"w-full h-full flex flex-col justify-center items-center",children:e.jsx(O,{lyrics:S,currentTime:p})}),e.jsxs("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 w-full max-w-md sm:max-w-xl z-20",children:[" ",e.jsxs("div",{className:"flex items-center justify-center gap-3 sm:gap-4 mt-4 p-2 bg-card/80 rounded-full shadow-lg backdrop-blur-md border border-border/50",children:[" ",e.jsx(h,{onClick:()=>d(!r),variant:"ghost",size:"icon",className:"w-9 h-9 sm:w-10 sm:h-10 text-foreground hover:bg-accent hover:text-accent-foreground",children:r?e.jsx(T,{className:"w-5 h-5 sm:w-6 sm:h-6"}):e.jsx(D,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsx("input",{type:"range",min:0,max:y,value:p,onChange:m=>{var x;return(x=j.current)==null?void 0:x.seekTo(parseFloat(m.target.value))},className:"w-full h-1.5 bg-muted rounded-lg appearance-none cursor-pointer range-sm accent-primary"}),e.jsx(h,{onClick:()=>f(!u),variant:"ghost",size:"icon",className:"w-9 h-9 sm:w-10 sm:h-10 text-foreground hover:bg-accent hover:text-accent-foreground",children:u?e.jsx(q,{className:"w-5 h-5 sm:w-6 sm:h-6"}):e.jsx(K,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]})]})]})]}):e.jsx(b,{message:"Something went wrong."})};export{$ as default};
