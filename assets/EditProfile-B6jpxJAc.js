import{r as l,j as e,d as x,X as G,b as J,n as K,k as Q,x as Z,H as ee,B as E,L as ae,a as _,s as F}from"./main-DjNC3G64.js";import{u as te,F as se,a as S,b as g,c as b,d as v,e as y,t as re,o as ne,s as w,l as k}from"./form-CKMLyXiC.js";import{I as A}from"./input-jGJX85w3.js";import{R as oe,P as le,C as L,a as ie,b as I,D as T,O as R}from"./index-DqfUTldv.js";import{A as V,a as Y,b as z}from"./avatar-Drb_kw9a.js";import{f as me}from"./supabaseHelpers-DuDpU6fp.js";import{B as ce}from"./BackgroundWrapper-B09iK6D5.js";import{S as de,a as xe,b as ue,c as pe,d as P}from"./select-BWmIXSgJ.js";import{U}from"./user-B0P-7kxa.js";import{M as fe}from"./mail-D_0Pom4h.js";import{U as he}from"./users-DyCn6oqI.js";import{I as ge}from"./image-D9hMTw9k.js";import{M as be,S as je}from"./sun-0q5ySZqH.js";import{A as Ne}from"./arrow-left-CCXN5EYU.js";import"./label-BhBloIXZ.js";import"./index-BNhSlDgx.js";import"./index-DPQf-OcN.js";import"./check-J0izW_e_.js";const ve=oe,ye=le,O=l.forwardRef(({className:s,...a},r)=>e.jsx(R,{ref:r,className:x("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a}));O.displayName=R.displayName;const B=l.forwardRef(({className:s,children:a,...r},o)=>e.jsxs(ye,{children:[e.jsx(O,{}),e.jsxs(L,{ref:o,className:x("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r,children:[a,e.jsxs(ie,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));B.displayName=L.displayName;const M=({className:s,...a})=>e.jsx("div",{className:x("flex flex-col space-y-1.5 text-center sm:text-left",s),...a});M.displayName="DialogHeader";const H=l.forwardRef(({className:s,...a},r)=>e.jsx(I,{ref:r,className:x("text-lg font-semibold leading-none tracking-tight",s),...a}));H.displayName=I.displayName;const $=l.forwardRef(({className:s,...a},r)=>e.jsx(T,{ref:r,className:x("text-sm text-muted-foreground",s),...a}));$.displayName=T.displayName;const we=({selectedAvatar:s,onSelect:a,numAvatars:r=10})=>{const[o,m]=l.useState(null),c=[],u=["romeo","juliet"];for(let n=1;n<=r;n++)u.forEach(p=>{c.push(`/avatars/${n}${p}.jpg`)});l.useEffect(()=>{m(s)},[s]);const j=n=>{m(n),a(n)};return e.jsx("div",{className:"relative w-full max-w-md mx-auto",children:e.jsx("div",{className:"grid grid-cols-3 gap-3 p-2 justify-items-center",children:c.map(n=>{var p;return e.jsxs("div",{className:x("relative cursor-pointer transition-all duration-200 p-0.5 rounded-full shadow-md",o===n?"ring-3 ring-primary dark:ring-primary":"hover:ring-1 hover:ring-accent dark:hover:ring-accent"),onClick:()=>j(n),children:[e.jsxs(V,{className:"w-16 h-16 sm:w-20 sm:h-20 aspect-square overflow-hidden block flex-shrink-0 rounded-full border-2 border-transparent",children:[e.jsx(Y,{src:n,alt:`Avatar ${(p=n.split("/").pop())==null?void 0:p.split(".")[0]}`,className:"object-cover"}),e.jsx(z,{className:"bg-muted text-muted-foreground",children:"AV"})]}),o===n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-primary/30 rounded-full",children:e.jsx("span",{className:"text-primary-foreground text-xl sm:text-2xl",children:"âœ“"})})]},n)})})})},ke=({isOpen:s,onOpenChange:a,selectedAvatar:r,onSelect:o})=>{const m=c=>{o(c),a(!1)};return e.jsx(ve,{open:s,onOpenChange:a,children:e.jsxs(B,{className:"w-[90%] max-w-[380px] sm:max-w-[425px] p-4 sm:p-6 bg-card/80 backdrop-blur-md border border-border/50 rounded-xl",children:[e.jsxs(M,{children:[e.jsx(H,{className:"text-foreground text-lg sm:text-xl",children:"Select Your Avatar"}),e.jsx($,{className:"text-muted-foreground text-sm sm:text-base",children:"Choose a new avatar from the options below."})]}),e.jsx("div",{className:"py-3 sm:py-4 max-h-[350px] sm:max-h-[400px] overflow-y-auto",children:e.jsx(we,{selectedAvatar:r,onSelect:m,numAvatars:10})})]})})},_e=ne({nickname:w().min(2,{message:"Nickname must be at least 2 characters."}).optional().or(k("")),partner_email:w().email({message:"Please enter a valid partner email address."}).optional().or(k("")),partner_nickname:w().min(2,{message:"Partner nickname must be at least 2 characters."}).optional().or(k("")),avatar_url:w().optional().or(k(""))}).refine(s=>{var o;const a=window.dyadSessionContext,r=(o=a==null?void 0:a.user)==null?void 0:o.email;return s.partner_email===""||s.partner_email!==r},{message:"Your partner's email cannot be the same as your own email.",path:["partner_email"]}),He=()=>{var C;const s=J(),{user:a,loading:r}=K(),{theme:o,setTheme:m}=Q(),[c,u]=l.useState(!0),[j,n]=l.useState(null),[p,N]=l.useState(null),[q,D]=l.useState(!1),i=te({resolver:re(_e),defaultValues:{nickname:"",partner_email:"",partner_nickname:"",avatar_url:""}});l.useEffect(()=>{window.dyadSessionContext={user:a,loading:r}},[a,r]),l.useEffect(()=>{(async()=>{if(!r&&a){const f=a.user_metadata.avatar_url||"";n(f),i.reset({nickname:a.user_metadata.nickname||"",partner_email:a.user_metadata.partner_email||"",partner_nickname:a.user_metadata.partner_nickname||"",avatar_url:f});const h=a.user_metadata.partner_email;if(h)try{const d=await me(h);N(d||null)}catch{N(null)}else N(null);u(!1)}else!r&&!a&&s("/login")})()},[a,r,s,i]);const W=t=>{n(t),i.setValue("avatar_url",t,{shouldValidate:!0})},X=async t=>{if(!a){_.error("User not authenticated.");return}u(!0);try{const{data:f,error:h}=await F.auth.updateUser({data:{nickname:t.nickname,partner_email:t.partner_email,partner_nickname:t.partner_nickname,avatar_url:t.avatar_url}});if(h)throw h;const{error:d}=await F.from("profiles").update({username:t.nickname,partner_email:t.partner_email,partner_nickname:t.partner_nickname,avatar_url:t.avatar_url}).eq("id",a.id);if(d)throw d;_.success("Profile updated successfully!"),s("/dashboard")}catch(f){_.error("Failed to update profile: "+f.message)}finally{u(!1)}};return r||c?e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-background to-background/80 text-foreground",children:[e.jsx(Z,{}),e.jsx("p",{className:"text-xl mt-4",children:"Loading profile..."})]}):a?e.jsxs(e.Fragment,{children:[e.jsxs(ee,{children:[e.jsx("title",{children:"Edit Profile - Anbae"}),e.jsx("meta",{name:"description",content:"Update your Anbae profile, including nickname, partner details, avatar, and theme preferences."})]}),e.jsx(ce,{className:"pt-0 md:pt-0",children:e.jsxs("div",{className:"w-full max-w-sm sm:max-w-md bg-card/60 dark:bg-card/60 p-6 sm:p-8 rounded-xl shadow-lg backdrop-blur-md border border-border/50 mt-16 md:mt-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(U,{className:"w-10 h-10 sm:w-12 sm:h-12 text-primary mx-auto mb-3 sm:mb-4"}),e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-1 sm:mb-2",children:"Edit Your Profile"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Update your personal and partner details."})]}),e.jsx(se,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(X),className:"space-y-5 sm:space-y-6",children:[e.jsx(S,{control:i.control,name:"nickname",render:({field:t})=>e.jsxs(g,{children:[e.jsxs(b,{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(U,{className:"w-4 h-4 text-primary"})," Nickname"]}),e.jsx(v,{children:e.jsx(A,{placeholder:"Your Nickname",...t,value:t.value||"",className:"bg-input/50 border-border/50 text-foreground text-sm sm:text-base"})}),e.jsx(y,{className:"text-xs sm:text-sm"})]})}),e.jsx(S,{control:i.control,name:"partner_email",render:({field:t})=>e.jsxs(g,{children:[e.jsxs(b,{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(fe,{className:"w-4 h-4 text-primary"})," Partner's Email"]}),e.jsx(v,{children:e.jsx(A,{placeholder:"partner@example.com",...t,type:"email",value:t.value||"",className:"bg-input/50 border-border/50 text-foreground text-sm sm:text-base"})}),e.jsx(y,{className:"text-xs sm:text-sm"})]})}),e.jsx(S,{control:i.control,name:"partner_nickname",render:({field:t})=>e.jsxs(g,{children:[e.jsxs(b,{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(he,{className:"w-4 h-4 text-primary"})," Partner's Nickname"]}),e.jsx(v,{children:e.jsx(A,{placeholder:"Your Partner's Nickname",...t,value:t.value||"",className:"bg-input/50 border-border/50 text-foreground text-sm sm:text-base"})}),e.jsx(y,{className:"text-xs sm:text-sm"})]})}),e.jsxs(g,{children:[e.jsxs(b,{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(ge,{className:"w-4 h-4 text-primary"})," Select Your Avatar"]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs(V,{className:"w-16 h-16 sm:w-20 sm:h-20 border-2 border-primary mx-auto rounded-full cursor-pointer shadow-md",onClick:()=>D(!0),children:[e.jsx(Y,{src:j||"",alt:"Your Avatar"}),e.jsx(z,{className:"bg-primary text-primary-foreground",children:"AV"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Click your avatar to change it"})]}),e.jsx(ke,{isOpen:q,onOpenChange:D,selectedAvatar:j,onSelect:W}),e.jsx(y,{className:"text-xs sm:text-sm",children:(C=i.formState.errors.avatar_url)==null?void 0:C.message})]}),e.jsxs(g,{children:[e.jsxs(b,{className:"flex items-center gap-2 text-sm sm:text-base",children:[o==="dark"?e.jsx(be,{className:"w-4 h-4 text-primary"}):e.jsx(je,{className:"w-4 h-4 text-primary"})," Theme"]}),e.jsxs(de,{onValueChange:t=>m(t),value:o,children:[e.jsx(v,{children:e.jsx(xe,{className:"bg-input/50 border-border/50 text-foreground text-sm sm:text-base h-10",children:e.jsx(ue,{placeholder:"Select theme"})})}),e.jsxs(pe,{className:"bg-card border-border text-foreground text-sm sm:text-base",children:[e.jsx(P,{value:"light",children:"Light"}),e.jsx(P,{value:"dark",children:"Dark"}),e.jsx(P,{value:"system",children:"System"})]})]})]}),e.jsx(E,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground text-sm sm:text-base py-2 sm:py-2.5",children:"Save Changes"})]})}),e.jsx("div",{className:"mt-5 sm:mt-6 text-center",children:e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx(ae,{to:"/dashboard",children:e.jsx(E,{variant:"outline",size:"icon",className:"w-9 h-9 sm:w-10 sm:h-10 rounded-full text-foreground border-border hover:bg-accent hover:text-accent-foreground shadow-md",children:e.jsx(Ne,{className:"w-4 h-4 sm:w-5 sm:h-5"})})})})})]})})]}):null};export{He as default};
