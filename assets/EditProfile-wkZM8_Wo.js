import{r as l,j as e,d as u,X as G,b as J,l as K,i as Q,H as Z,B as E,L as ee,a as _,s as F}from"./main-BHPIGV8h.js";import{u as ae,F as re,a as S,b as g,c as j,d as N,e as y,t as te,o as se,s as k,l as w}from"./form-Bb0e-UzI.js";import{I as A}from"./input-Ds3Oh0yx.js";import{R as ne,P as oe,C as I,a as le,b as L,D as T,O as R}from"./index-DLG690HK.js";import{A as V,a as Y,b as z}from"./avatar-M7QsreIS.js";import{f as ie}from"./supabaseHelpers-CPJLcMFB.js";import{B as ce}from"./BackgroundWrapper-C6a75pID.js";import{S as de,a as me,b as ue,c as pe,d as P}from"./select-BVSOCHce.js";import{U}from"./user-S_xWp1ZB.js";import{M as xe}from"./mail-D4aJpkB7.js";import{U as fe}from"./users-D5Y8rFmf.js";import{I as he}from"./image-nRX6Np3r.js";import{M as ge,S as je}from"./sun-z8w-mBh5.js";import{A as be}from"./arrow-left-C4HDbgt0.js";import"./index-CIk3TtyT.js";import"./index-CBatG-58.js";import"./check-CszRzhCn.js";const ve=ne,Ne=oe,O=l.forwardRef(({className:t,...a},s)=>e.jsx(R,{ref:s,className:u("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...a}));O.displayName=R.displayName;const B=l.forwardRef(({className:t,children:a,...s},o)=>e.jsxs(Ne,{children:[e.jsx(O,{}),e.jsxs(I,{ref:o,className:u("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s,children:[a,e.jsxs(le,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));B.displayName=I.displayName;const M=({className:t,...a})=>e.jsx("div",{className:u("flex flex-col space-y-1.5 text-center sm:text-left",t),...a});M.displayName="DialogHeader";const H=l.forwardRef(({className:t,...a},s)=>e.jsx(L,{ref:s,className:u("text-lg font-semibold leading-none tracking-tight",t),...a}));H.displayName=L.displayName;const $=l.forwardRef(({className:t,...a},s)=>e.jsx(T,{ref:s,className:u("text-sm text-muted-foreground",t),...a}));$.displayName=T.displayName;const ye=({selectedAvatar:t,onSelect:a,numAvatars:s=10})=>{const[o,c]=l.useState(null),d=[],p=["romeo","juliet"];for(let n=1;n<=s;n++)p.forEach(x=>{d.push(`/avatars/${n}${x}.jpg`)});l.useEffect(()=>{c(t)},[t]);const b=n=>{c(n),a(n)};return e.jsx("div",{className:"relative w-full max-w-md mx-auto",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 p-4 justify-items-center",children:d.map(n=>{var x;return e.jsxs("div",{className:u("relative cursor-pointer transition-all duration-200 p-1 rounded-full shadow-md",o===n?"ring-4 ring-primary dark:ring-primary":"hover:ring-2 hover:ring-accent dark:hover:ring-accent"),onClick:()=>b(n),children:[e.jsxs(V,{className:"w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 aspect-square overflow-hidden block flex-shrink-0 rounded-full border-2 border-transparent",children:[e.jsx(Y,{src:n,alt:`Avatar ${(x=n.split("/").pop())==null?void 0:x.split(".")[0]}`,className:"object-cover"}),e.jsx(z,{className:"bg-muted text-muted-foreground",children:"AV"})]}),o===n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-primary/30 rounded-full",children:e.jsx("span",{className:"text-primary-foreground text-2xl",children:"âœ“"})})]},n)})})})},ke=({isOpen:t,onOpenChange:a,selectedAvatar:s,onSelect:o})=>{const c=d=>{o(d),a(!1)};return e.jsx(ve,{open:t,onOpenChange:a,children:e.jsxs(B,{className:"sm:max-w-[425px] p-6 bg-card/80 backdrop-blur-md border border-border/50 rounded-xl",children:[e.jsxs(M,{children:[e.jsx(H,{className:"text-foreground",children:"Select Your Avatar"}),e.jsx($,{className:"text-muted-foreground",children:"Choose a new avatar from the options below."})]}),e.jsx("div",{className:"py-4 max-h-[400px] overflow-y-auto",children:e.jsx(ye,{selectedAvatar:s,onSelect:c,numAvatars:10})})]})})},we=se({nickname:k().min(2,{message:"Nickname must be at least 2 characters."}).optional().or(w("")),partner_email:k().email({message:"Please enter a valid partner email address."}).optional().or(w("")),partner_nickname:k().min(2,{message:"Partner nickname must be at least 2 characters."}).optional().or(w("")),avatar_url:k().optional().or(w(""))}).refine(t=>{var o;const a=window.dyadSessionContext,s=(o=a==null?void 0:a.user)==null?void 0:o.email;return t.partner_email===""||t.partner_email!==s},{message:"Your partner's email cannot be the same as your own email.",path:["partner_email"]}),Be=()=>{var C;const t=J(),{user:a,loading:s}=K(),{theme:o,setTheme:c}=Q(),[d,p]=l.useState(!0),[b,n]=l.useState(null),[x,v]=l.useState(null),[q,D]=l.useState(!1),i=ae({resolver:te(we),defaultValues:{nickname:"",partner_email:"",partner_nickname:"",avatar_url:""}});l.useEffect(()=>{window.dyadSessionContext={user:a,loading:s}},[a,s]),l.useEffect(()=>{(async()=>{if(!s&&a){const f=a.user_metadata.avatar_url||"";n(f),i.reset({nickname:a.user_metadata.nickname||"",partner_email:a.user_metadata.partner_email||"",partner_nickname:a.user_metadata.partner_nickname||"",avatar_url:f});const h=a.user_metadata.partner_email;if(h)try{const m=await ie(h);v(m||null)}catch{v(null)}else v(null);p(!1)}else!s&&!a&&t("/login")})()},[a,s,t,i]);const W=r=>{n(r),i.setValue("avatar_url",r,{shouldValidate:!0})},X=async r=>{if(!a){_.error("User not authenticated.");return}p(!0);try{const{data:f,error:h}=await F.auth.updateUser({data:{nickname:r.nickname,partner_email:r.partner_email,partner_nickname:r.partner_nickname,avatar_url:r.avatar_url}});if(h)throw h;const{error:m}=await F.from("profiles").update({username:r.nickname,partner_email:r.partner_email,partner_nickname:r.partner_nickname,avatar_url:r.avatar_url}).eq("id",a.id);if(m)throw m;_.success("Profile updated successfully!"),t("/dashboard")}catch(f){_.error("Failed to update profile: "+f.message)}finally{p(!1)}};return s||d?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-background/80 text-foreground",children:e.jsx("p",{className:"text-xl",children:"Loading profile..."})}):a?e.jsxs(e.Fragment,{children:[e.jsxs(Z,{children:[e.jsx("title",{children:"Edit Profile - Anbae"}),e.jsx("meta",{name:"description",content:"Update your Anbae profile, including nickname, partner details, avatar, and theme preferences."})]}),e.jsx(ce,{className:"pt-0 md:pt-0",children:e.jsxs("div",{className:"w-full max-w-md bg-card/60 dark:bg-card/60 p-8 rounded-xl shadow-lg backdrop-blur-md border border-border/50 mt-16 md:mt-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(U,{className:"w-12 h-12 text-primary mx-auto mb-4"}),e.jsx("h2",{className:"text-3xl font-bold text-foreground mb-2",children:"Edit Your Profile"}),e.jsx("p",{className:"text-muted-foreground",children:"Update your personal and partner details."})]}),e.jsx(re,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(X),className:"space-y-6",children:[e.jsx(S,{control:i.control,name:"nickname",render:({field:r})=>e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-primary"})," Nickname"]}),e.jsx(N,{children:e.jsx(A,{placeholder:"Your Nickname",...r,value:r.value||"",className:"bg-input/50 border-border/50 text-foreground"})}),e.jsx(y,{})]})}),e.jsx(S,{control:i.control,name:"partner_email",render:({field:r})=>e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-primary"})," Partner's Email"]}),e.jsx(N,{children:e.jsx(A,{placeholder:"partner@example.com",...r,type:"email",value:r.value||"",className:"bg-input/50 border-border/50 text-foreground"})}),e.jsx(y,{})]})}),e.jsx(S,{control:i.control,name:"partner_nickname",render:({field:r})=>e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4 text-primary"})," Partner's Nickname"]}),e.jsx(N,{children:e.jsx(A,{placeholder:"Your Partner's Nickname",...r,value:r.value||"",className:"bg-input/50 border-border/50 text-foreground"})}),e.jsx(y,{})]})}),e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4 text-primary"})," Select Your Avatar"]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs(V,{className:"w-20 h-20 border-2 border-primary mx-auto rounded-full cursor-pointer shadow-md",onClick:()=>D(!0),children:[e.jsx(Y,{src:b||"",alt:"Your Avatar"}),e.jsx(z,{className:"bg-primary text-primary-foreground",children:"AV"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Click your avatar to change it"})]}),e.jsx(ke,{isOpen:q,onOpenChange:D,selectedAvatar:b,onSelect:W}),e.jsx(y,{children:(C=i.formState.errors.avatar_url)==null?void 0:C.message})]}),e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[o==="dark"?e.jsx(ge,{className:"w-4 h-4 text-primary"}):e.jsx(je,{className:"w-4 h-4 text-primary"})," Theme"]}),e.jsxs(de,{onValueChange:r=>c(r),value:o,children:[e.jsx(N,{children:e.jsx(me,{className:"bg-input/50 border-border/50 text-foreground",children:e.jsx(ue,{placeholder:"Select theme"})})}),e.jsxs(pe,{className:"bg-card border-border text-foreground",children:[e.jsx(P,{value:"light",children:"Light"}),e.jsx(P,{value:"dark",children:"Dark"}),e.jsx(P,{value:"system",children:"System"})]})]})]}),e.jsx(E,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",children:"Save Changes"})]})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("div",{className:"absolute top-4 left-4 z-10",children:e.jsx(ee,{to:"/dashboard",children:e.jsx(E,{variant:"outline",size:"icon",className:"w-10 h-10 rounded-full text-foreground border-border hover:bg-accent hover:text-accent-foreground shadow-md",children:e.jsx(be,{className:"w-5 h-5"})})})})})]})})]}):null};export{Be as default};
